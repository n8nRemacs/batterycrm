# TODO –Ω–∞ 29.12.2025

## –ú—É–ª—å—Ç–∏–∫–∞–Ω–∞–ª WhatsApp + –ê–≤—Ç–æ-–æ—á–∏—Å—Ç–∫–∞ —Å–µ—Å—Å–∏–π

---

## –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

### –¢–µ–∫—É—â–∞—è —Å–∏—Ç—É–∞—Ü–∏—è

–ü—Ä–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è —á–µ—Ä–µ–∑ WhatsApp –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ:
- Workflow `ELO_Out_WhatsApp` –æ—Ç—Ä–∞–±–æ—Ç–∞–ª, –Ω–æ–¥–∞ "Send via Baileys" –≤–µ—Ä–Ω—É–ª–∞ `success: true`
- –ù–æ —Å–æ–æ–±—â–µ–Ω–∏–µ **–ù–ï –¥–æ—à–ª–æ** –¥–æ –ø–æ–ª—É—á–∞—Ç–µ–ª—è

### –ü—Ä–∏—á–∏–Ω–∞

–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã 3 —Å–µ—Å—Å–∏–∏ WhatsApp:

| Session ID | Status | –¢–µ–ª–µ—Ñ–æ–Ω | –ü—Ä–æ–±–ª–µ–º–∞ |
|------------|--------|---------|----------|
| `eldoleado_arceos` | ‚úÖ connected | +7 999 725 37 77 | OK |
| `wa_22222222-..._1766570899887` | ‚úÖ connected | +7 917 170 80 77 | OK |
| `wa_22222222-..._1766570852204` | ‚ùå **qr** | ‚Äî | **–ñ–¥—ë—Ç QR-–∫–æ–¥, –Ω–µ –∑–∞–ª–æ–≥–∏–Ω–µ–Ω–∞** |

**–ü—Ä–æ–±–ª–µ–º–∞:** Baileys –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `success: true` –¥–∞–∂–µ –¥–ª—è —Å–µ—Å—Å–∏–π –≤ —Å—Ç–∞—Ç—É—Å–µ `qr`, –ø–æ—Ç–æ–º—É —á—Ç–æ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –ø–∞–º—è—Ç–∏, –Ω–æ —Ä–µ–∞–ª—å–Ω–æ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç (–Ω–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å WhatsApp —Å–µ—Ä–≤–µ—Ä–∞–º–∏).

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

1. **"–ú—ë—Ä—Ç–≤—ã–µ" —Å–µ—Å—Å–∏–∏** ‚Äî —Å–µ—Å—Å–∏–∏ –≤ —Å—Ç–∞—Ç—É—Å–µ `qr` –≤–∏—Å—è—Ç –≤ –ø–∞–º—è—Ç–∏ –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ, –∑–∞–Ω–∏–º–∞—é—Ç —Ä–µ—Å—É—Ä—Å—ã
2. **–ù–µ—Ç –ª–∏–º–∏—Ç–æ–≤** ‚Äî –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –Ω–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫–∫–∞—É–Ω—Ç–æ–≤ –Ω–∞ –∫–∞–Ω–∞–ª
3. **UI –Ω–µ –≥–æ—Ç–æ–≤** ‚Äî Android –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –∞–∫–∫–∞—É–Ω—Ç–æ–≤ –Ω–∞ –∫–∞–Ω–∞–ª

---

## –ó–∞–¥–µ–π—Å—Ç–≤–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (PostgreSQL 185.221.214.83:6544)

| –¢–∞–±–ª–∏—Ü–∞ | –û–ø–∏—Å–∞–Ω–∏–µ | –ò–∑–º–µ–Ω–µ–Ω–∏—è |
|---------|----------|-----------|
| `elo_t_tenants` | –ê—Ä–µ–Ω–¥–∞—Ç–æ—Ä—ã (—Å–µ—Ä–≤–∏—Å–Ω—ã–µ —Ü–µ–Ω—Ç—Ä—ã) | –î–æ–±–∞–≤–∏—Ç—å `channel_limits JSONB` |
| `elo_t_channel_accounts` | –ê–∫–∫–∞—É–Ω—Ç—ã –∫–∞–Ω–∞–ª–æ–≤ | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `session_status` –¥–ª—è –ø–æ–¥—Å—á—ë—Ç–∞ |
| `elo_channels` | –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –∫–∞–Ω–∞–ª–æ–≤ | –ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π |

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ `elo_t_channel_accounts`:**
```
id              | uuid
tenant_id       | uuid (FK ‚Üí elo_t_tenants)
channel_id      | integer (FK ‚Üí elo_channels)
account_id      | varchar(255)
session_id      | varchar(100)
session_status  | varchar(20) ‚Äî 'pending', 'qr', 'connected', 'disconnected'
is_active       | boolean
```

### MCP –°–µ—Ä–≤–µ—Ä WhatsApp

| –§–∞–π–ª | –û–ø–∏—Å–∞–Ω–∏–µ | –ò–∑–º–µ–Ω–µ–Ω–∏—è |
|------|----------|-----------|
| `NEW/MVP/MCP/mcp-whatsapp-baileys/src/session.ts` | SessionManager | –î–æ–±–∞–≤–∏—Ç—å –∞–≤—Ç–æ-–æ—á–∏—Å—Ç–∫—É |
| `NEW/MVP/MCP/mcp-whatsapp-baileys/src/index.ts` | REST API | –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É —Å—Ç–∞—Ç—É—Å–∞ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π |
| `NEW/MVP/MCP/mcp-whatsapp-baileys/src/baileys.ts` | BaileysClient | –ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π |

**–°–µ—Ä–≤–µ—Ä:** `155.212.221.189:8769` (IP1), `217.114.14.17:8769` (IP2)

### n8n Workflows

| Workflow | –û–ø–∏—Å–∞–Ω–∏–µ | –ò–∑–º–µ–Ω–µ–Ω–∏—è |
|----------|----------|-----------|
| `ELO_Out_WhatsApp.json` | –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π | –ü—Ä–æ–≤–µ—Ä–∫–∞ `session_status === 'connected'` |
| `ELO_API_Android_Auth.json` | –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ | –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–æ–≤ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Å–µ—Å—Å–∏–∏ |
| `ELO_API_Android_Dialogs.json` | –°–ø–∏—Å–æ–∫ –¥–∏–∞–ª–æ–≥–æ–≤ | –ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π |

### Android –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

| –ú–æ–¥—É–ª—å | –û–ø–∏—Å–∞–Ω–∏–µ | –ò–∑–º–µ–Ω–µ–Ω–∏—è |
|--------|----------|-----------|
| `ChannelSetupActivity` | –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–∞–Ω–∞–ª–∞ | –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∞–∫–∫–∞—É–Ω—Ç–æ–≤ |
| `WhatsAppSetupActivity` | –ù–∞—Å—Ç—Ä–æ–π–∫–∞ WhatsApp | QR-—Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∞–∫–∫–∞—É–Ω—Ç–æ–≤ |
| `ChannelAccountAdapter` | –ê–¥–∞–ø—Ç–µ—Ä —Å–ø–∏—Å–∫–∞ | –ù–æ–≤—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç |
| `ApiService` | API –∫–ª–∏–µ–Ω—Ç | –ù–æ–≤—ã–µ endpoints |

---

## –ó–∞–¥–∞—á–∞ 1: –ê–≤—Ç–æ-—É–¥–∞–ª–µ–Ω–∏–µ –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö QR-—Å–µ—Å—Å–∏–π

### –ü—Ä–æ–±–ª–µ–º–∞
–°–µ—Å—Å–∏–∏ –≤ —Å—Ç–∞—Ç—É—Å–µ `qr` –≤–∏—Å—è—Ç –≤ –ø–∞–º—è—Ç–∏ –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–≥ –∑–∞–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, –Ω–µ –æ—Ç—Å–∫–∞–Ω–∏—Ä–æ–≤–∞–≤ QR. –°–µ—Å—Å–∏—è –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å QR-–∫–æ–¥—ã –∫–∞–∂–¥—ã–µ 20 —Å–µ–∫—É–Ω–¥, –ø–æ—Ç—Ä–µ–±–ª—è—è —Ä–µ—Å—É—Ä—Å—ã.

### –†–µ—à–µ–Ω–∏–µ
–£–¥–∞–ª—è—Ç—å —Å–µ—Å—Å–∏–∏ –∏–∑ –ø–∞–º—è—Ç–∏ —Å–µ—Ä–≤–µ—Ä–∞ –µ—Å–ª–∏ —Å—Ç–∞—Ç—É—Å `qr` –¥–µ—Ä–∂–∏—Ç—Å—è –±–æ–ª–µ–µ 10 –º–∏–Ω—É—Ç.

### –§–∞–π–ª: `NEW/MVP/MCP/mcp-whatsapp-baileys/src/session.ts`

**–í–∞—Ä–∏–∞–Ω—Ç A: setInterval –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ (–ø—Ä–æ—Å—Ç–æ–π)**

```typescript
export class SessionManager {
  private sessions: Map<string, BaileysClient> = new Map();
  private sessionCreatedAt: Map<string, number> = new Map();
  private cleanupInterval: NodeJS.Timeout;

  constructor(config: SessionManagerConfig) {
    // ... existing code ...

    // –ó–∞–ø—É—Å–∫ –æ—á–∏—Å—Ç–∫–∏ –∫–∞–∂–¥—ã–µ 60 —Å–µ–∫—É–Ω–¥
    this.cleanupInterval = setInterval(() => {
      this.cleanupStaleQRSessions();
    }, 60 * 1000);
  }

  async createSession(request: CreateSessionRequest): Promise<{ sessionId: string; hash: string }> {
    // ... existing code ...

    // –ó–∞–ø–∏—Å–∞—Ç—å –≤—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è
    this.sessionCreatedAt.set(sessionId, Date.now());

    return { sessionId, hash };
  }

  private cleanupStaleQRSessions(): void {
    const QR_TIMEOUT_MS = 10 * 60 * 1000; // 10 –º–∏–Ω—É—Ç
    const now = Date.now();

    for (const [sessionId, client] of this.sessions) {
      const createdAt = this.sessionCreatedAt.get(sessionId) || 0;
      const status = client.getStatus();

      if (status === 'qr' && now - createdAt > QR_TIMEOUT_MS) {
        logger.info({ sessionId }, 'Removing stale QR session (10 min timeout)');
        this.deleteSession(sessionId);
        this.sessionCreatedAt.delete(sessionId);
      }
    }
  }

  async shutdown(): Promise<void> {
    clearInterval(this.cleanupInterval);
    // ... existing shutdown code ...
  }
}
```

**–í–∞—Ä–∏–∞–Ω—Ç B: Timeout –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Å–µ—Å—Å–∏–∏ (—Ç–æ—á–Ω–µ–µ)**

```typescript
async createSession(request: CreateSessionRequest): Promise<{ sessionId: string; hash: string }> {
  // ... existing code ...

  // –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç–∞–π–º–µ—Ä –Ω–∞ —É–¥–∞–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 10 –º–∏–Ω—É—Ç
  const timeoutId = setTimeout(() => {
    const client = this.sessions.get(sessionId);
    if (client && client.getStatus() === 'qr') {
      logger.info({ sessionId }, 'Removing stale QR session (10 min timeout)');
      this.deleteSession(sessionId);
    }
  }, 10 * 60 * 1000);

  // –û—Ç–º–µ–Ω–∏—Ç—å —Ç–∞–π–º–µ—Ä –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏
  client.on('connected', () => {
    clearTimeout(timeoutId);
  });

  return { sessionId, hash };
}
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –í–∞—Ä–∏–∞–Ω—Ç A ‚Äî –ø—Ä–æ—â–µ, –Ω–∞–¥—ë–∂–Ω–µ–µ (–Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Å–æ–±—ã—Ç–∏–π), –ª–µ–≥—á–µ –æ—Ç–ª–∞–∂–∏–≤–∞—Ç—å.

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
1. –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é —Å–µ—Å—Å–∏—é: `POST /sessions`
2. –ù–ï —Å–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å QR-–∫–æ–¥
3. –ü–æ–¥–æ–∂–¥–∞—Ç—å 10 –º–∏–Ω—É—Ç
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: `GET /sessions` ‚Äî —Å–µ—Å—Å–∏—è –¥–æ–ª–∂–Ω–∞ –∏—Å—á–µ–∑–Ω—É—Ç—å
5. –í –ª–æ–≥–∞—Ö: `Removing stale QR session (10 min timeout)`

---

## –ó–∞–¥–∞—á–∞ 2: –î–æ–±–∞–≤–∏—Ç—å channel_limits –≤ –ë–î

### –ü—Ä–æ–±–ª–µ–º–∞
–ù–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫–∫–∞—É–Ω—Ç–æ–≤ –∫–∞–Ω–∞–ª–∞ –¥–ª—è tenant'–∞. –ú–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å 100 WhatsApp –∞–∫–∫–∞—É–Ω—Ç–æ–≤, —á—Ç–æ:
- –ü–µ—Ä–µ–≥—Ä—É–∑–∏—Ç —Å–µ—Ä–≤–µ—Ä
- –°–æ–∑–¥–∞—Å—Ç –ø—Ä–æ–±–ª–µ–º—ã —Å –º–æ–¥–µ—Ä–∞—Ü–∏–µ–π
- –£—Å–ª–æ–∂–Ω–∏—Ç UI

### –†–µ—à–µ–Ω–∏–µ
–î–æ–±–∞–≤–∏—Ç—å –ª–∏–º–∏—Ç—ã –Ω–∞ —É—Ä–æ–≤–Ω–µ tenant'–∞. –ù–∞ —ç—Ç–∞–ø–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è ‚Äî –ª–∏–º–∏—Ç 1 –Ω–∞ –∫–∞–∂–¥—ã–π –∫–∞–Ω–∞–ª.

### –ú–∏–≥—Ä–∞—Ü–∏—è SQL

```sql
-- –î–æ–±–∞–≤–∏—Ç—å –∫–æ–ª–æ–Ω–∫—É channel_limits
ALTER TABLE elo_t_tenants
ADD COLUMN channel_limits JSONB DEFAULT '{
  "whatsapp": 1,
  "telegram": 1,
  "avito": 1,
  "vk": 1,
  "max": 1,
  "form": 3
}';

-- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
COMMENT ON COLUMN elo_t_tenants.channel_limits IS
'–õ–∏–º–∏—Ç –∞–∫–∫–∞—É–Ω—Ç–æ–≤ –Ω–∞ –∫–∞–Ω–∞–ª. JSON: {"whatsapp": 1, "telegram": 1, ...}';

-- –ò–Ω–¥–µ–∫—Å –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
CREATE INDEX idx_elo_t_tenants_channel_limits
ON elo_t_tenants USING GIN (channel_limits);

-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å
SELECT id, name, channel_limits FROM elo_t_tenants;
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ channel_limits

```json
{
  "whatsapp": 1,    // 1 –∞–∫–∫–∞—É–Ω—Ç WhatsApp
  "telegram": 1,    // 1 –±–æ—Ç Telegram
  "avito": 3,       // 3 –∞–∫–∫–∞—É–Ω—Ç–∞ Avito (—Ä–∞–∑–Ω—ã–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è)
  "vk": 1,          // 1 —Å–æ–æ–±—â–µ—Å—Ç–≤–æ VK
  "max": 1,         // 1 –∞–∫–∫–∞—É–Ω—Ç MAX
  "form": 5         // 5 —Ñ–æ—Ä–º –Ω–∞ —Å–∞–π—Ç–µ
}
```

### –í–∞—Ä–∏–∞–Ω—Ç—ã —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è (–±—É–¥—É—â–µ–µ)

**–í–∞—Ä–∏–∞–Ω—Ç A: –ü—Ä–æ—Å—Ç–æ–π ‚Äî –ª–∏–º–∏—Ç –≤ JSON**
- –ü–ª—é—Å—ã: –ü—Ä–æ—Å—Ç–æ, –≥–∏–±–∫–æ
- –ú–∏–Ω—É—Å—ã: –ù–µ—Ç –∏—Å—Ç–æ—Ä–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π

**–í–∞—Ä–∏–∞–Ω—Ç B: –û—Ç–¥–µ–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ elo_t_tenant_limits**
```sql
CREATE TABLE elo_t_tenant_limits (
  tenant_id UUID REFERENCES elo_t_tenants(id),
  channel_code VARCHAR(20),
  max_accounts INT DEFAULT 1,
  valid_from TIMESTAMP DEFAULT now(),
  valid_until TIMESTAMP,
  PRIMARY KEY (tenant_id, channel_code)
);
```
- –ü–ª—é—Å—ã: –ò—Å—Ç–æ—Ä–∏—è, —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è (–ø–æ–¥–ø–∏—Å–∫–∞)
- –ú–∏–Ω—É—Å—ã: –°–ª–æ–∂–Ω–µ–µ

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ù–∞—á–∞—Ç—å —Å –í–∞—Ä–∏–∞–Ω—Ç–∞ A (JSON), –ø–æ—Ç–æ–º –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ B –µ—Å–ª–∏ –Ω—É–∂–Ω—ã –ø–æ–¥–ø–∏—Å–∫–∏.

---

## –ó–∞–¥–∞—á–∞ 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Å–µ—Å—Å–∏–∏

### –ü—Ä–æ–±–ª–µ–º–∞
–ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –ª–∏–º–∏—Ç–∞. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞—Ç—å –±–æ–ª—å—à–µ –∞–∫–∫–∞—É–Ω—Ç–æ–≤, —á–µ–º —Ä–∞–∑—Ä–µ—à–µ–Ω–æ.

### –†–µ—à–µ–Ω–∏–µ
–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –≤ –¥–≤—É—Ö –º–µ—Å—Ç–∞—Ö:
1. **MCP —Å–µ—Ä–≤–µ—Ä** ‚Äî –ø—Ä–∏ `POST /sessions`
2. **n8n workflow** ‚Äî –ø—Ä–∏ –≤—ã–∑–æ–≤–µ –∏–∑ Android

### –í–∞—Ä–∏–∞–Ω—Ç A: –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ MCP —Å–µ—Ä–≤–µ—Ä–µ

**–§–∞–π–ª:** `NEW/MVP/MCP/mcp-whatsapp-baileys/src/index.ts`

```typescript
// POST /sessions
app.post('/sessions', authMiddleware, async (req, res) => {
  try {
    const request: CreateSessionRequest = req.body;
    const { tenantId } = request;

    // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–∏–º–∏—Ç
    if (tenantId) {
      const limitCheck = await checkChannelLimit(tenantId, 'whatsapp');
      if (!limitCheck.allowed) {
        return sendError(res, limitCheck.message, 403, 'LIMIT_EXCEEDED');
      }
    }

    const { sessionId, hash } = await sessionManager.createSession(request);
    // ... rest of code
  } catch (err: any) {
    sendError(res, err.message, 400);
  }
});

async function checkChannelLimit(tenantId: string, channelCode: string): Promise<{allowed: boolean; message: string}> {
  // –ó–∞–ø—Ä–æ—Å –∫ PostgreSQL
  const result = await db.query(`
    SELECT
      (t.channel_limits->>$2)::int as limit_value,
      COUNT(ca.id) as current_count
    FROM elo_t_tenants t
    LEFT JOIN elo_t_channel_accounts ca ON ca.tenant_id = t.id
      AND ca.channel_id = (SELECT id FROM elo_channels WHERE code = $2)
      AND ca.session_status = 'connected'
    WHERE t.id = $1
    GROUP BY t.id
  `, [tenantId, channelCode]);

  const { limit_value, current_count } = result.rows[0];

  if (current_count >= limit_value) {
    return {
      allowed: false,
      message: `–õ–∏–º–∏—Ç –∞–∫–∫–∞—É–Ω—Ç–æ–≤ ${channelCode} –¥–æ—Å—Ç–∏–≥–Ω—É—Ç (${current_count}/${limit_value})`
    };
  }

  return { allowed: true, message: '' };
}
```

### –í–∞—Ä–∏–∞–Ω—Ç B: –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ n8n workflow

**–§–∞–π–ª:** `NEW/workflows/API/ELO_API_Android_Auth.json`

–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–¥—É –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º —Å–µ—Å—Å–∏–∏:

```javascript
// Code node: Check Channel Limit
const tenantId = $('Get Tenant').item.json.tenant_id;
const channelCode = $input.item.json.channel;

// –ó–∞–ø—Ä–æ—Å –∫ –ë–î
const limitQuery = `
  SELECT
    (t.channel_limits->>'${channelCode}')::int as limit_value,
    COUNT(ca.id) as current_count
  FROM elo_t_tenants t
  LEFT JOIN elo_t_channel_accounts ca ON ca.tenant_id = t.id
    AND ca.channel_id = (SELECT id FROM elo_channels WHERE code = '${channelCode}')
    AND ca.session_status = 'connected'
  WHERE t.id = '${tenantId}'
  GROUP BY t.id
`;

// –†–µ–∑—É–ª—å—Ç–∞—Ç
const result = $('PostgreSQL').item.json;
if (result.current_count >= result.limit_value) {
  throw new Error(`–õ–∏–º–∏—Ç –∞–∫–∫–∞—É–Ω—Ç–æ–≤ ${channelCode} –¥–æ—Å—Ç–∏–≥–Ω—É—Ç (${result.current_count}/${result.limit_value})`);
}

return $input.item;
```

### –í–∞—Ä–∏–∞–Ω—Ç C: –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ Android (–∫–ª–∏–µ–Ω—Ç—Å–∫–∞—è)

**–§–∞–π–ª:** `app/src/main/java/com/eldoleado/app/ui/channels/WhatsAppSetupActivity.kt`

```kotlin
private fun checkLimitAndCreateSession() {
    lifecycleScope.launch {
        val limits = apiService.getChannelLimits(tenantId)
        val accounts = apiService.getChannelAccounts(tenantId, "whatsapp")

        if (accounts.size >= limits.whatsapp) {
            showError("–õ–∏–º–∏—Ç –∞–∫–∫–∞—É–Ω—Ç–æ–≤ WhatsApp –¥–æ—Å—Ç–∏–≥–Ω—É—Ç (${accounts.size}/${limits.whatsapp})")
            binding.btnAddAccount.isEnabled = false
            return@launch
        }

        // –°–æ–∑–¥–∞—Ç—å —Å–µ—Å—Å–∏—é
        createWhatsAppSession()
    }
}
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ö–æ–º–±–∏–Ω–∞—Ü–∏—è B + C:
- n8n –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ª–∏–º–∏—Ç (–Ω–∞–¥—ë–∂–Ω–æ, –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ)
- Android –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ª–∏–º–∏—Ç –≤ UI (UX)

---

## –ó–∞–¥–∞—á–∞ 4: UI –≤ Android ‚Äî —Å–ø–∏—Å–æ–∫ –∞–∫–∫–∞—É–Ω—Ç–æ–≤ –∫–∞–Ω–∞–ª–∞

### –ü—Ä–æ–±–ª–µ–º–∞
–°–µ–π—á–∞—Å UI –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω –∞–∫–∫–∞—É–Ω—Ç –Ω–∞ –∫–∞–Ω–∞–ª. –ù—É–∂–Ω–æ:
1. –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∞–∫–∫–∞—É–Ω—Ç–æ–≤
2. –û—Ç–æ–±—Ä–∞–∂–∞—Ç—å —Å—Ç–∞—Ç—É—Å –∫–∞–∂–¥–æ–≥–æ (connected/qr/disconnected)
3. –ü–æ–∑–≤–æ–ª—è—Ç—å –¥–æ–±–∞–≤–ª—è—Ç—å/—É–¥–∞–ª—è—Ç—å –∞–∫–∫–∞—É–Ω—Ç—ã
4. –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –ª–∏–º–∏—Ç

### –î–∏–∑–∞–π–Ω —ç–∫—Ä–∞–Ω–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  ‚Üê WhatsApp                                    ‚öôÔ∏è   ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                     ‚îÇ
‚îÇ  –ü–æ–¥–∫–ª—é—á—ë–Ω–Ω—ã–µ –∞–∫–∫–∞—É–Ω—Ç—ã                              ‚îÇ
‚îÇ                                                     ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ üü¢ +7 999 725 37 77                         ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ    –î–º–∏—Ç—Ä–∏–π                                  ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ    –ü–æ–¥–∫–ª—é—á—ë–Ω ‚Ä¢ eldoleado_arceos             ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ                              [–û—Ç–∫–ª—é—á–∏—Ç—å]    ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îÇ                                                     ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ üü¢ +7 917 170 80 77                         ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ    –†–µ–º–∞–∫—Å                                   ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ    –ü–æ–¥–∫–ª—é—á—ë–Ω ‚Ä¢ wa_22222222-...              ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ                              [–û—Ç–∫–ª—é—á–∏—Ç—å]    ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îÇ                                                     ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ üü° –û–∂–∏–¥–∞–Ω–∏–µ QR-–∫–æ–¥–∞...                      ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ    wa_22222222-..._1766570852204            ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ                    [–ü–æ–∫–∞–∑–∞—Ç—å QR] [–£–¥–∞–ª–∏—Ç—å]  ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îÇ                                                     ‚îÇ
‚îÇ  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  ‚îÇ
‚îÇ                                                     ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ           [+ –î–æ–±–∞–≤–∏—Ç—å –∞–∫–∫–∞—É–Ω—Ç]              ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îÇ                                                     ‚îÇ
‚îÇ  –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ: 2/3 –∞–∫–∫–∞—É–Ω—Ç–æ–≤                        ‚îÇ
‚îÇ                                                     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –ù–æ–≤—ã–µ API endpoints

**1. –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∞–∫–∫–∞—É–Ω—Ç–æ–≤ –∫–∞–Ω–∞–ª–∞**
```
GET /api/v2/channels/{channel}/accounts?tenant_id={uuid}

Response:
{
  "success": true,
  "data": {
    "accounts": [
      {
        "id": "uuid",
        "session_id": "eldoleado_arceos",
        "phone": "+79997253777",
        "name": "–î–º–∏—Ç—Ä–∏–π",
        "status": "connected",
        "created_at": "2025-12-28T10:00:00Z"
      },
      {
        "id": "uuid",
        "session_id": "wa_22222222-...",
        "phone": null,
        "name": null,
        "status": "qr",
        "created_at": "2025-12-28T15:00:00Z"
      }
    ],
    "limit": 3,
    "used": 2
  }
}
```

**2. –ü–æ–ª—É—á–∏—Ç—å –ª–∏–º–∏—Ç—ã tenant'–∞**
```
GET /api/v2/tenants/{tenant_id}/limits

Response:
{
  "success": true,
  "data": {
    "whatsapp": { "limit": 3, "used": 2 },
    "telegram": { "limit": 1, "used": 1 },
    "avito": { "limit": 5, "used": 0 }
  }
}
```

**3. –£–¥–∞–ª–∏—Ç—å –∞–∫–∫–∞—É–Ω—Ç**
```
DELETE /api/v2/channels/{channel}/accounts/{account_id}

Response:
{
  "success": true,
  "message": "–ê–∫–∫–∞—É–Ω—Ç –æ—Ç–∫–ª—é—á—ë–Ω"
}
```

### –§–∞–π–ª—ã Android

**–ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã:**

| –§–∞–π–ª | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| `ChannelAccountsActivity.kt` | –≠–∫—Ä–∞–Ω —Å–ø–∏—Å–∫–∞ –∞–∫–∫–∞—É–Ω—Ç–æ–≤ –∫–∞–Ω–∞–ª–∞ |
| `ChannelAccountAdapter.kt` | –ê–¥–∞–ø—Ç–µ—Ä RecyclerView –¥–ª—è —Å–ø–∏—Å–∫–∞ |
| `ChannelAccountViewHolder.kt` | ViewHolder –¥–ª—è —ç–ª–µ–º–µ–Ω—Ç–∞ —Å–ø–∏—Å–∫–∞ |
| `item_channel_account.xml` | Layout —ç–ª–µ–º–µ–Ω—Ç–∞ —Å–ø–∏—Å–∫–∞ |
| `activity_channel_accounts.xml` | Layout —ç–∫—Ä–∞–Ω–∞ |

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö:**

| –§–∞–π–ª | –ò–∑–º–µ–Ω–µ–Ω–∏–µ |
|------|-----------|
| `WhatsAppSetupActivity.kt` | –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ `ChannelAccountsActivity` –ø–æ—Å–ª–µ QR |
| `ApiService.kt` | –ù–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã API |
| `navigation.xml` | –ù–æ–≤—ã–π destination |

### Model classes

```kotlin
// ChannelAccount.kt
data class ChannelAccount(
    val id: String,
    val sessionId: String,
    val phone: String?,
    val name: String?,
    val status: AccountStatus,
    val createdAt: String
)

enum class AccountStatus {
    CONNECTED,    // üü¢ –ü–æ–¥–∫–ª—é—á—ë–Ω
    QR,           // üü° –û–∂–∏–¥–∞–µ—Ç QR
    DISCONNECTED, // üî¥ –û—Ç–∫–ª—é—á—ë–Ω
    ERROR         // ‚ö†Ô∏è –û—à–∏–±–∫–∞
}

// ChannelLimits.kt
data class ChannelLimits(
    val limit: Int,
    val used: Int
) {
    val available: Int get() = limit - used
    val isLimitReached: Boolean get() = used >= limit
}
```

### –õ–æ–≥–∏–∫–∞ –∫–Ω–æ–ø–∫–∏ "–î–æ–±–∞–≤–∏—Ç—å –∞–∫–∫–∞—É–Ω—Ç"

```kotlin
private fun updateAddButton(limits: ChannelLimits) {
    binding.btnAddAccount.apply {
        isEnabled = !limits.isLimitReached

        if (limits.isLimitReached) {
            text = "–õ–∏–º–∏—Ç –¥–æ—Å—Ç–∏–≥–Ω—É—Ç"
            setBackgroundColor(Color.GRAY)
        } else {
            text = "+ –î–æ–±–∞–≤–∏—Ç—å –∞–∫–∫–∞—É–Ω—Ç"
            setBackgroundColor(getColor(R.color.primary))
        }
    }

    binding.tvLimitInfo.text = "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ: ${limits.used}/${limits.limit} –∞–∫–∫–∞—É–Ω—Ç–æ–≤"
}
```

---

## –ü–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

| # | –ó–∞–¥–∞—á–∞ | –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ | –°–ª–æ–∂–Ω–æ—Å—Ç—å | –í—Ä–µ–º—è |
|---|--------|-------------|-----------|-------|
| 1 | –ê–≤—Ç–æ-—É–¥–∞–ª–µ–Ω–∏–µ QR-—Å–µ—Å—Å–∏–π | ‚Äî | –ù–∏–∑–∫–∞—è | 30 –º–∏–Ω |
| 2 | channel_limits –≤ –ë–î | ‚Äî | –ù–∏–∑–∫–∞—è | 15 –º–∏–Ω |
| 3 | –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–∞ | –ó–∞–¥–∞—á–∞ 2 | –°—Ä–µ–¥–Ω—è—è | 1-2 —á–∞—Å–∞ |
| 4 | UI —Å–ø–∏—Å–æ–∫ –∞–∫–∫–∞—É–Ω—Ç–æ–≤ | –ó–∞–¥–∞—á–∏ 2, 3 | –í—ã—Å–æ–∫–∞—è | 3-4 —á–∞—Å–∞ |

**–û–±—â–µ–µ –≤—Ä–µ–º—è:** ~6 —á–∞—Å–æ–≤

---

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç 1: –ê–≤—Ç–æ-—É–¥–∞–ª–µ–Ω–∏–µ
1. –°–æ–∑–¥–∞—Ç—å —Å–µ—Å—Å–∏—é WhatsApp
2. –ù–ï —Å–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å QR
3. –ü–æ–¥–æ–∂–¥–∞—Ç—å 11 –º–∏–Ω—É—Ç
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `GET /sessions` ‚Äî —Å–µ—Å—Å–∏—è —É–¥–∞–ª–µ–Ω–∞
5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏: `Removing stale QR session`

### –¢–µ—Å—Ç 2: –õ–∏–º–∏—Ç
1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ª–∏–º–∏—Ç WhatsApp = 1
2. –ü–æ–¥–∫–ª—é—á–∏—Ç—å 1 –∞–∫–∫–∞—É–Ω—Ç (connected)
3. –ü–æ–ø—ã—Ç–∞—Ç—å—Å—è —Å–æ–∑–¥–∞—Ç—å –≤—Ç–æ—Ä–æ–π
4. –û–∂–∏–¥–∞–Ω–∏–µ: –æ—à–∏–±–∫–∞ `–õ–∏–º–∏—Ç –∞–∫–∫–∞—É–Ω—Ç–æ–≤ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç (1/1)`

### –¢–µ—Å—Ç 3: UI
1. –û—Ç–∫—Ä—ã—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ WhatsApp
2. –í–∏–¥–µ—Ç—å —Å–ø–∏—Å–æ–∫ –∞–∫–∫–∞—É–Ω—Ç–æ–≤
3. –ù–∞–∂–∞—Ç—å "–î–æ–±–∞–≤–∏—Ç—å" ‚Üí –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è QR
4. –ù–∞–∂–∞—Ç—å "–û—Ç–∫–ª—é—á–∏—Ç—å" ‚Üí –∞–∫–∫–∞—É–Ω—Ç —É–¥–∞–ª—è–µ—Ç—Å—è
5. –ü—Ä–∏ –ª–∏–º–∏—Ç–µ ‚Üí –∫–Ω–æ–ø–∫–∞ "–î–æ–±–∞–≤–∏—Ç—å" –Ω–µ–∞–∫—Ç–∏–≤–Ω–∞

---

## –ó–∞–º–µ—Ç–∫–∏

### –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–µ—Å—Å–∏–π (28.12.2025)

**IP1 (155.212.221.189:8769):**
- ‚úÖ `eldoleado_arceos` ‚Äî +7 999 725 37 77 (–î–º–∏—Ç—Ä–∏–π)
- ‚úÖ `wa_22222222-..._1766570899887` ‚Äî +7 917 170 80 77 (–†–µ–º–∞–∫—Å)
- ‚ùå `wa_22222222-..._1766570852204` ‚Äî –∂–¥—ë—Ç QR (—É–¥–∞–ª–∏—Ç—å –ø–æ—Å–ª–µ –∑–∞–¥–∞—á–∏ 1)

**IP2 (217.114.14.17:8769):**
- –ü—É—Å—Ç–æ

### –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–µ—Å—Å–∏–∏
ssh root@155.212.221.189 "curl -s http://155.212.221.189:8769/sessions"

# –õ–æ–≥–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
ssh root@155.212.221.189 "docker logs mcp-whatsapp-ip1 --tail 50"

# –°—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
ssh root@155.212.221.189 "docker ps | grep whatsapp"
```

### –°—Å—ã–ª–∫–∏ –Ω–∞ —Ñ–∞–π–ª—ã

- MCP WhatsApp: `NEW/MVP/MCP/mcp-whatsapp-baileys/`
- Workflows: `NEW/workflows/`
- Android: `app/src/main/java/com/eldoleado/app/`
