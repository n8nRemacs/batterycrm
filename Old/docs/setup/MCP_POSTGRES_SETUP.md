# MCP Setup –¥–ª—è PostgreSQL/Supabase

## ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ

### MCP –°–µ—Ä–≤–µ—Ä –¥–ª—è PostgreSQL
- **–ü–∞–∫–µ—Ç**: `@henkey/postgres-mcp-server`
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ü—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –∫ PostgreSQL –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö BatteryCRM —á–µ—Ä–µ–∑ Claude Code
- **–°—Ç–∞—Ç—É—Å**: ‚úì Connected

## üìã –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### Connection String
```
postgresql://postgres:Mi31415926pSss!@db.cfaelqdjknmopodvxmyw.supabase.co:5432/postgres
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:**
- **Host**: `db.cfaelqdjknmopodvxmyw.supabase.co`
- **Port**: `5432` (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π PostgreSQL)
- **Database**: `postgres`
- **User**: `postgres`
- **Password**: `Mi31415926pSss!`

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤ Claude Code

–§–∞–π–ª: `~/.claude.json` (Windows: `C:\Users\User\.claude.json`)

```json
{
  "mcpServers": {
    "postgres-batterycrm": {
      "type": "stdio",
      "command": "npx",
      "args": ["@henkey/postgres-mcp-server"],
      "env": {
        "POSTGRES_CONNECTION_STRING": "postgresql://postgres:Mi31415926pSss!@db.cfaelqdjknmopodvxmyw.supabase.co:5432/postgres"
      }
    }
  }
}
```

## üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö BatteryCRM

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ (26 —Ç–∞–±–ª–∏—Ü)

#### Multi-tenant
- `tenants` - –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä—ã (SaaS –∏–∑–æ–ª—è—Ü–∏—è)
- `tenant_configs` - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–æ–≤

#### –ö–ª–∏–µ–Ω—Ç—ã
- `clients` - –∫–ª–∏–µ–Ω—Ç—ã (21 –∫–æ–ª–æ–Ω–∫–∞)
- `client_merges` - –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –¥—É–±–ª–∏—Ä—É—é—â–∏—Ö—Å—è –∫–ª–∏–µ–Ω—Ç–æ–≤

#### –û–±—Ä–∞—â–µ–Ω–∏—è
- `appeals` - –æ–±—Ä–∞—â–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–æ–≤ (48 –∫–æ–ª–æ–Ω–æ–∫!)
- `messages_history` - –∏—Å—Ç–æ—Ä–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π

#### –û–ø–µ—Ä–∞—Ç–æ—Ä—ã
- `operators` - –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã —Å–µ—Ä–≤–∏—Å–∞
- `operator_actions` - –¥–µ–π—Å—Ç–≤–∏—è –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤
- `operator_appeal_status` - –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –æ–±—Ä–∞—â–µ–Ω–∏–π
- `operator_devices` - Android —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤

#### –ö–∞–Ω–∞–ª—ã –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏
- `channels` - –∫–∞–Ω–∞–ª—ã (Telegram, WhatsApp, VK –∏ —Ç.–¥.)
- `sales_channels` - –∫–∞–Ω–∞–ª—ã –ø—Ä–æ–¥–∞–∂
- `lead_sources` - –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –ª–∏–¥–æ–≤ (UTM –º–µ—Ç–∫–∏)

#### –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏
- `device_types` - —Ç–∏–ø—ã —É—Å—Ç—Ä–æ–π—Å—Ç–≤ (—Å–º–∞—Ä—Ç—Ñ–æ–Ω, –ø–ª–∞–Ω—à–µ—Ç –∏ —Ç.–¥.)
- `brands` - –±—Ä–µ–Ω–¥—ã (Apple, Samsung...)
- `models` - –º–æ–¥–µ–ª–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤
- `repair_types` - —Ç–∏–ø—ã —Ä–µ–º–æ–Ω—Ç–∞
- `issue_types` - —Ç–∏–ø—ã –ø—Ä–æ–±–ª–µ–º
- `issues` - –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã
- `deal_types` - —Ç–∏–ø—ã —Å–¥–µ–ª–æ–∫
- `services` - —É—Å–ª—É–≥–∏ –∏ —Ü–µ–Ω—ã
- `masters` - –º–∞—Å—Ç–µ—Ä–∞
- `appointments` - –∑–∞–ø–∏—Å–∏ –Ω–∞ –ø—Ä–∏—ë–º
- `knowledge_base` - –±–∞–∑–∞ –∑–Ω–∞–Ω–∏–π
- `appeal_meta_config` - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
- `appeal_meta_visibility` - –ø—Ä–∞–≤–∏–ª–∞ –≤–∏–¥–∏–º–æ—Å—Ç–∏

#### Firebase
- `fcm_tokens` - —Ç–æ–∫–µ–Ω—ã –¥–ª—è push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤ —á–µ—Ä–µ–∑ Claude Code

#### –ü—Ä–æ—Å–º–æ—Ç—Ä –¥–∞–Ω–Ω—ã—Ö
```
Claude, –ø–æ–∫–∞–∂–∏ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 5 –æ–±—Ä–∞—â–µ–Ω–∏–π –∏–∑ —Ç–∞–±–ª–∏—Ü—ã appeals
```

```
Claude, —Å–∫–æ–ª—å–∫–æ –≤—Å–µ–≥–æ –∫–ª–∏–µ–Ω—Ç–æ–≤ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö?
```

```
Claude, –ø–æ–∫–∞–∂–∏ –≤—Å–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã operator_devices
```

#### –ê–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö
```
Claude, –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ–±—Ä–∞—â–µ–Ω–∏–π –ø–æ –∫–∞–Ω–∞–ª–∞–º
```

```
Claude, –∫–∞–∫–∏–µ —Å–∞–º—ã–µ —á–∞—Å—Ç—ã–µ —Ç–∏–ø—ã —Ä–µ–º–æ–Ω—Ç–æ–≤ –≤ –±–∞–∑–µ?
```

#### –°–ª–æ–∂–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
```
Claude, –Ω–∞–π–¥–∏ –≤—Å–µ—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤ —Å –Ω–µ–∑–∞–∫—Ä—ã—Ç—ã–º–∏ –æ–±—Ä–∞—â–µ–Ω–∏—è–º–∏ –∏ –ø–æ–∫–∞–∂–∏ –∏—Ö –∫–æ–Ω—Ç–∞–∫—Ç—ã
```

```
Claude, –ø–æ—Å—Ç—Ä–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –æ–±—Ä–∞—â–µ–Ω–∏–π –ø–æ –¥–Ω—è–º –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π –º–µ—Å—è—Ü
```

## üõ†Ô∏è –î–æ—Å—Ç—É–ø–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã MCP

### @henkey/postgres-mcp-server –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç:

1. **query** - –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ SQL –∑–∞–ø—Ä–æ—Å–æ–≤
2. **list_tables** - —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü
3. **describe_table** - –æ–ø–∏—Å–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ç–∞–±–ª–∏—Ü—ã
4. **get_schema** - –ø–æ–ª—É—á–∏—Ç—å —Å—Ö–µ–º—É –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
5. **execute_sql** - –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω–æ–≥–æ SQL

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

‚ö†Ô∏è **–í–ê–ñ–ù–û**: MCP —Å–µ—Ä–≤–µ—Ä –∏–º–µ–µ—Ç –ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ –ë–î —Å –ø—Ä–∞–≤–∞–º–∏ `postgres` –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ–ª—å–∫–æ –¥–ª—è development/testing
- ‚ùå –ù–ï –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –Ω–∞ production –±–∞–∑–µ –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π
- üîê –•—Ä–∞–Ω–∏—Ç–µ –ø–∞—Ä–æ–ª–∏ –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

## üìä –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–æ—Å—Ç—É–ø–∞ –∫ –ë–î

### 1. Supabase Manager (—É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)
```bash
python supabase_manager.py list        # –°–ø–∏—Å–æ–∫ —Ç–∞–±–ª–∏—Ü
python supabase_manager.py export      # –≠–∫—Å–ø–æ—Ä—Ç —Å—Ö–µ–º—ã
```

### 2. –ü—Ä—è–º–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ psql
```bash
psql "postgresql://postgres:Mi31415926pSss!@db.cfaelqdjknmopodvxmyw.supabase.co:5432/postgres"
```

### 3. Supabase REST API (—á–µ—Ä–µ–∑ supabase_manager.py)
- URL: `https://supabase.n8nsrv.ru/rest/v1/`
- Service Role Key: `eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...`

### 4. n8n PostgreSQL –Ω–æ–¥—ã
- –£–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –≤–æ –≤—Å–µ—Ö –≤–æ—Ä–∫–µ—Ä–∞—Ö
- Credential: "Postgres account"

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å MCP —Å–µ—Ä–≤–µ—Ä–æ–≤
```bash
claude mcp list
```

–î–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å:
```
‚úì postgres-batterycrm: npx @henkey/postgres-mcp-server - Connected
```

### ‚ö†Ô∏è –í–ê–ñ–ù–û: –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø—Ä—è–º–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

**–ü—Ä—è–º–æ–µ PostgreSQL –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ (–ø–æ—Ä—Ç 5432) –º–æ–∂–µ—Ç –±—ã—Ç—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ** –≤ self-hosted Supabase –ø–æ —Å–æ–æ–±—Ä–∞–∂–µ–Ω–∏—è–º –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.

**–†–∞–±–æ—Ç–∞—é—â–∏–µ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã**:

1. **Supabase REST API** (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è) ‚úÖ
   ```bash
   python supabase_manager.py list
   ```

2. **PostgREST —á–µ—Ä–µ–∑ MCP** (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
   - MCP —Å–µ—Ä–≤–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–∞ REST API –µ—Å–ª–∏ –ø—Ä—è–º–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ

3. **n8n PostgreSQL –Ω–æ–¥—ã** (—É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ) ‚úÖ
   - –í—Å–µ –≤–æ—Ä–∫–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ "Postgres account"

### –¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å —á–µ—Ä–µ–∑ REST API
```bash
python supabase_manager.py list
```

–î–æ–ª–∂–Ω–æ –≤—ã–≤–µ—Å—Ç–∏ —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö 26 —Ç–∞–±–ª–∏—Ü.

## üìñ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
- [Database_Structure_BatteryCRM_COMPLETE.md](Database_Structure_BatteryCRM_COMPLETE.md) - –ø–æ–ª–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ë–î
- [README_SUPABASE_MANAGER.md](README_SUPABASE_MANAGER.md) - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ö–µ–º–æ–π
- [supabase_manager.py](supabase_manager.py) - —Å–∫—Ä–∏–ø—Ç –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞ —Å—Ö–µ–º—ã
- [run_migration.py](run_migration.py) - —Å–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–π

### –í–Ω–µ—à–Ω–∏–µ —Ä–µ—Å—É—Ä—Å—ã
- **Supabase Dashboard**: https://supabase.n8nsrv.ru
- **PostgreSQL Docs**: https://www.postgresql.org/docs/
- **@henkey/postgres-mcp-server**: https://npm.im/@henkey/postgres-mcp-server

## üéØ –ü–æ–ª–Ω–∞—è –∫–∞—Ä—Ç–∏–Ω–∞ MCP —Å–µ—Ä–≤–µ—Ä–æ–≤

–¢–µ–ø–µ—Ä—å –≤ Claude Code –¥–æ—Å—Ç—É–ø–Ω—ã **4 MCP —Å–µ—Ä–≤–µ—Ä–∞**:

1. ‚úÖ **mcpandroidbuild** - —Å–±–æ—Ä–∫–∞ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Android
2. ‚úÖ **memory** - –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–∞—è –ø–∞–º—è—Ç—å –º–µ–∂–¥—É —Å–µ—Å—Å–∏—è–º–∏
3. ‚úÖ **mobile-mcp** - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Android —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏
4. ‚úÖ **postgres-batterycrm** - –¥–æ—Å—Ç—É–ø –∫ PostgreSQL –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

–≠—Ç–æ –¥–∞—ë—Ç –ø–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥:
- üì± Android —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–æ–π
- üóÑÔ∏è –ë–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
- ü§ñ –≠–º—É–ª—è—Ç–æ—Ä–∞–º–∏ –∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏
- üíæ –ö–æ–Ω—Ç–µ–∫—Å—Ç–æ–º –ø—Ä–æ–µ–∫—Ç–∞

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –•—Ä–∞–Ω–∏—Ç–µ –≤ —Å–µ–∫—Ä–µ—Ç–µ
- ‚ùå Database password: `Mi31415926pSss!`
- ‚ùå Supabase Service Role Key
- ‚ùå Connection strings

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
1. –ù–µ –∫–æ–º–º–∏—Ç—å—Ç–µ `.claude.json` –≤ Git
2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
3. –†–µ–≥—É–ª—è—Ä–Ω–æ –º–µ–Ω—è–π—Ç–µ –ø–∞—Ä–æ–ª–∏
4. –û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –¥–æ—Å—Ç—É–ø –∫ production –±–∞–∑–µ

## ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ —Ä–∞–±–æ—Ç–µ!

–¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ:
- üîç –ó–∞–ø—Ä–∞—à–∏–≤–∞—Ç—å –ª—é–±—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –ë–î —á–µ—Ä–µ–∑ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–π —è–∑—ã–∫
- üìä –ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
- üõ†Ô∏è –í—ã–ø–æ–ª–Ω—è—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
- üì± –£–ø—Ä–∞–≤–ª—è—Ç—å Android –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º
- ü§ñ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ —ç–º—É–ª—è—Ç–æ—Ä–µ

**–í—Å—ë —á–µ—Ä–µ–∑ –æ–¥–∏–Ω –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å Claude Code! üöÄ**
