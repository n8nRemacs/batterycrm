# Статус проверки MCP серверов

**Дата проверки:** 2025-01-22
**Проект:** BattCRMApp

---

## Результаты проверки

| MCP Сервер | Статус | Описание |
|------------|--------|----------|
| **postgres-batterycrm** | ✅ Работает | Подключение к PostgreSQL успешно |
| **memory** | ✅ Работает | Knowledge graph доступен |
| **mobile-mcp** | ❌ Не работает | Нет подключенных устройств/эмуляторов |
| **android-adb** | ❌ Не работает | Ошибка Win32 при запуске |

---

## 1. PostgreSQL MCP ✅

### Статус: РАБОТАЕТ ОТЛИЧНО

**Проверка:**
```sql
SELECT current_database(), current_user, version();
```

**Результат:**
- База данных: `postgres`
- Пользователь: `supabase_admin`
- Версия: PostgreSQL 15.8 (64-bit)
- Таблиц в схеме public: 46

**Доступные операции:**
- ✅ Выполнение SQL запросов (SELECT, INSERT, UPDATE, DELETE)
- ✅ Управление схемой (таблицы, индексы, constraints)
- ✅ Управление функциями и триггерами
- ✅ Анализ производительности
- ✅ Управление пользователями и правами
- ✅ Экспорт/импорт данных
- ✅ Мониторинг базы данных

**Рекомендации:**
- Продолжать использовать для работы с БД
- Документация создана: `MCP_POSTGRES_CONFIG.md`

---

## 2. Memory MCP ✅

### Статус: РАБОТАЕТ КОРРЕКТНО

**Проверка:**
```
mcp__memory__read_graph
```

**Результат:**
- Entities: 0 (граф пустой)
- Relations: 0
- Сервер отвечает корректно

**Доступные операции:**
- ✅ Создание сущностей (entities)
- ✅ Создание связей (relations)
- ✅ Добавление наблюдений (observations)
- ✅ Поиск узлов (search nodes)
- ✅ Чтение графа знаний
- ✅ Удаление данных

**Что это дает:**
Memory MCP позволяет Claude запоминать информацию между сессиями в виде графа знаний:
- Информация о проекте
- Предпочтения пользователя
- Контекст задач
- Связи между компонентами системы

**Пример использования:**
```
Запомни, что в проекте BattCRMApp используется:
- База данных: PostgreSQL 15.8 на Supabase
- Система обращений с AI-роутингом
- N8N для автоматизации workflow
```

Claude создаст граф знаний и будет использовать эту информацию в будущих сессиях.

**Рекомендации:**
- Использовать для запоминания важной информации о проекте
- Полезно для долгосрочного контекста
- Граф пустой - можно начать наполнять по мере работы

---

## 3. Mobile MCP ❌

### Статус: НЕ РАБОТАЕТ

**Ошибка:**
```
Couldn't initialize the device.
Command failed: adb.exe shell settings put global window_animation_scale 0
adb.exe: no devices/emulators found
```

**Причина:**
Нет подключенных Android устройств или эмуляторов.

**Что нужно для работы:**

### Вариант 1: Подключить физическое устройство

1. **Включить режим разработчика на Android:**
   - Настройки → О телефоне
   - 7 раз нажать на "Номер сборки"
   - Появится сообщение "Вы стали разработчиком"

2. **Включить отладку по USB:**
   - Настройки → Для разработчиков
   - Включить "Отладка по USB"

3. **Подключить устройство к компьютеру по USB**

4. **Разрешить отладку на устройстве:**
   - При подключении появится запрос "Разрешить отладку?"
   - Нажать "Разрешить"

5. **Проверка:**
   ```bash
   adb devices
   ```
   Должно показать подключенное устройство.

### Вариант 2: Запустить эмулятор

1. **Через Android Studio:**
   - Открыть Android Studio
   - Tools → Device Manager
   - Создать новый виртуальный девайс (AVD)
   - Запустить эмулятор

2. **Через командную строку:**
   ```bash
   # Список доступных эмуляторов
   emulator -list-avds

   # Запуск эмулятора
   emulator -avd <имя_эмулятора>
   ```

3. **Проверка:**
   ```bash
   adb devices
   ```

### После подключения устройства:

Повторить инициализацию:
```
mobile_init
```

**Доступные операции (после исправления):**
- Дамп UI элементов на экране
- Нажатия (tap) на координаты
- Свайпы (swipe)
- Ввод текста
- Нажатие клавиш (back, home, enter)
- Скриншоты
- Список установленных приложений
- Открытие приложений по package name

**Рекомендации:**
- Если не планируете работать с мобильными устройствами - MCP можно отключить
- Для тестирования мобильного приложения - настроить эмулятор
- Для реального тестирования - подключить физическое устройство

---

## 4. Android Build MCP ❌

### Статус: НЕ РАБОТАЕТ

**Ошибка:**
```
[WinError 193] %1 не является приложением Win32
```

**Причина:**
Проблема с конфигурацией MCP сервера или путями к инструментам сборки.

**Возможные причины:**

1. **Gradle не найден или неверный путь**
2. **Проект не является Android проектом** (в текущей папке)
3. **Неверная архитектура исполняемых файлов** (32-bit vs 64-bit)
4. **MCP сервер установлен некорректно**

**Проверка окружения:**

```bash
# Проверка Gradle
gradle --version

# Проверка Android SDK
echo %ANDROID_HOME%

# Проверка Java
java -version

# Проверка структуры Android проекта
dir build.gradle
dir gradlew.bat
```

**Решение:**

### Вариант 1: Текущая папка не Android проект

Если BattCRMApp не содержит Android приложение:
```json
// Удалить или закомментировать в .claude/settings.local.json
{
  "mcpServers": {
    // "android-adb": { ... }  // Закомментировать
  }
}
```

### Вариант 2: Android проект в подпапке

Указать правильный путь:
```bash
# Использовать полный путь к Android проекту
mcp__mcpandroidbuild__build --folder "C:\Path\To\Android\Project"
```

### Вариант 3: Переустановить MCP сервер

```bash
# Удалить
claude mcp remove android-adb

# Установить заново
claude mcp add android-adb npx -y @landicefu/android-adb-mcp-server

# Перезапустить Claude Code
```

### Вариант 4: Проверить переменные окружения

Добавить в системные переменные:
```
ANDROID_HOME=C:\Users\User\AppData\Local\Android\Sdk
JAVA_HOME=C:\Program Files\Java\jdk-XX

Path:
  %ANDROID_HOME%\platform-tools
  %ANDROID_HOME%\tools
  %JAVA_HOME%\bin
```

**Доступные операции (после исправления):**
- Сборка Android проекта (build)
- Запуск юнит-тестов (test)
- Запуск инструментальных тестов (instrumentedTest)

**Рекомендации:**
- Если нет Android проекта в BattCRMApp - отключить этот MCP
- Если планируется разработка Android приложения - исправить конфигурацию
- Для работы требуется установленный Android SDK и Gradle

---

## Общие рекомендации

### Что работает сейчас:
1. ✅ **PostgreSQL MCP** - используйте для работы с БД
2. ✅ **Memory MCP** - используйте для сохранения контекста проекта

### Что нужно исправить:
3. ❌ **Mobile MCP** - подключить Android устройство/эмулятор или отключить
4. ❌ **Android Build MCP** - исправить конфигурацию или отключить

### Действия по приоритету:

#### Высокий приоритет:
- Продолжать использовать PostgreSQL MCP для работы с БД
- Начать использовать Memory MCP для запоминания контекста

#### Средний приоритет:
- Решить нужен ли Mobile MCP для проекта
- Решить нужен ли Android Build MCP для проекта

#### Низкий приоритет (если не используются):
- Отключить неработающие MCP для уменьшения overhead

### Как отключить ненужные MCP:

Отредактировать `.claude/settings.local.json`:

```json
{
  "mcpServers": {
    "postgres-batterycrm": {
      "command": "npx",
      "args": ["-y", "@batterycrm/mcp-postgres"],
      "env": {
        "POSTGRES_CONNECTION_STRING": "..."
      }
    },
    "memory": {
      "command": "npx",
      "args": ["-y", "@modelcontextprotocol/server-memory"]
    }
    // Закомментировать или удалить mobile-mcp и android-adb
  }
}
```

Перезапустить Claude Code.

---

## Проверка статуса MCP

Для проверки всех MCP в любое время:

```bash
# Список настроенных MCP
claude mcp list

# Проверка конфигурации
cat .claude/settings.local.json
```

Или попросить Claude:
```
Проверь работу всех MCP серверов
```

---

## Дополнительная документация

- PostgreSQL MCP: `MCP_POSTGRES_CONFIG.md`
- Memory MCP: https://github.com/modelcontextprotocol/servers/tree/main/src/memory
- Mobile MCP: `MCP_ANDROID_SETUP.md`
- Android Build: Документация @landicefu/android-adb-mcp-server

---

## Changelog

- 2025-01-22: Первая проверка всех MCP серверов
  - PostgreSQL: ✅ Работает
  - Memory: ✅ Работает
  - Mobile: ❌ Нет устройств
  - Android Build: ❌ Ошибка Win32
