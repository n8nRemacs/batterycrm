# üöÄ Deployment Checklist - AI Multi-Entity Extractor (OpenAI)

## –î–∞—Ç–∞: 2025-11-23
## –í–µ—Ä—Å–∏—è: OpenAI GPT-4o-mini
## –°—Ç–∞—Ç—É—Å: –ì–æ—Ç–æ–≤ –∫ –¥–µ–ø–ª–æ—é

---

## ‚úÖ Pre-Deployment Checklist

### 1. –§–∞–π–ª—ã –≥–æ—Ç–æ–≤—ã
- [x] `workflows/BAT AI Multi-Entity Extractor (OpenAI).json` - workflow —Å–æ–∑–¥–∞–Ω
- [x] `prompts/multi_entity_extractor_prompt.md` - –ø—Ä–æ–º–ø—Ç –≥–æ—Ç–æ–≤
- [x] OpenAI credentials —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –≤ n8n ‚úÖ

### 2. –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ OpenAI GPT-4o-mini
- ‚úÖ **–î–µ—à–µ–≤–ª–µ –≤ 10 —Ä–∞–∑**: $0.15/$0.60 –∑–∞ 1M —Ç–æ–∫–µ–Ω–æ–≤ (vs Anthropic $3/$15)
- ‚úÖ **Credentials —É–∂–µ –µ—Å—Ç—å** –≤ n8n
- ‚úÖ **–ù–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏**
- ‚úÖ **–ë—ã—Å—Ç—Ä–µ–µ**: –º–µ–Ω—å—à–µ latency
- ‚úÖ **–•–æ—Ä–æ—à–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å —Ä—É—Å—Å–∫–∏–º —è–∑—ã–∫–æ–º**

### 3. –°—Ç–æ–∏–º–æ—Å—Ç—å

**OpenAI GPT-4o-mini:**
- Input: $0.15 –∑–∞ 1M —Ç–æ–∫–µ–Ω–æ–≤
- Output: $0.60 –∑–∞ 1M —Ç–æ–∫–µ–Ω–æ–≤

**–°—Ä–µ–¥–Ω–∏–π –∑–∞–ø—Ä–æ—Å:**
- Input: ~1500 —Ç–æ–∫–µ–Ω–æ–≤
- Output: ~500 —Ç–æ–∫–µ–Ω–æ–≤
- **–°—Ç–æ–∏–º–æ—Å—Ç—å:** ~$0.0005 –∑–∞ –∑–∞–ø—Ä–æ—Å (–≤ 24 —Ä–∞–∑–∞ –¥–µ—à–µ–≤–ª–µ Anthropic!)

**–ú–µ—Å—è—á–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å** (–ø—Ä–∏ 1000 –∑–∞—è–≤–æ–∫/–º–µ—Å—è—Ü):
- ~$0.50/–º–µ—Å—è—Ü (vs Anthropic $12/–º–µ—Å—è—Ü)

---

## üìã Deployment Steps

### –®–∞–≥ 1: –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å Workflow –≤ n8n

**–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è –¢–†–ï–ë–£–ï–¢–°–Ø –î–ï–ô–°–¢–í–ò–ï

**–ß–µ—Ä–µ–∑ UI:**

1. –û—Ç–∫—Ä—ã—Ç—å —Ñ–∞–π–ª `workflows/BAT AI Multi-Entity Extractor (OpenAI).json`
2. –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤—Å—ë —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ (Ctrl+A, Ctrl+C)
3. –û—Ç–∫—Ä—ã—Ç—å n8n UI: https://n8n.n8nsrv.ru
4. –í –ª–µ–≤–æ–º –º–µ–Ω—é: **Workflows** ‚Üí **+** ‚Üí **Import from Clipboard**
5. –í—Å—Ç–∞–≤–∏—Ç—å JSON (Ctrl+V)
6. –ù–∞–∂–∞—Ç—å **Import**

---

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Credentials

**–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è –¢–†–ï–ë–£–ï–¢–°–Ø –î–ï–ô–°–¢–í–ò–ï

**2.1 PostgreSQL Credentials**

–î–ª—è nodes: Load Brands, Load Models, Load Repair Categories

1. –ö–ª–∏–∫–Ω—É—Ç—å –Ω–∞ –∫–∞–∂–¥—ã–π node
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å credential: `Postgres account`
3. –ï—Å–ª–∏ –Ω–µ –≤—ã–±—Ä–∞–Ω: –≤—ã–±—Ä–∞—Ç—å –∏–∑ dropdown

**2.2 OpenAI Credential**

–î–ª—è node **Call OpenAI**:

1. –ö–ª–∏–∫–Ω—É—Ç—å –Ω–∞ node
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å credential: `OpenAI account`
3. –ï—Å–ª–∏ –Ω–µ –≤—ã–±—Ä–∞–Ω: –≤—ã–±—Ä–∞—Ç—å –∏–∑ dropdown
4. –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –≤—ã–±—Ä–∞–Ω–∞ –º–æ–¥–µ–ª—å: `gpt-4o-mini`

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã OpenAI node:**
- Model: `gpt-4o-mini`
- Temperature: `0.3` (–¥–ª—è –±–æ–ª–µ–µ –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤)
- Max Tokens: `4096`

---

### –®–∞–≥ 3: –°–æ—Ö—Ä–∞–Ω–∏—Ç—å Workflow

**–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è –¢–†–ï–ë–£–ï–¢–°–Ø –î–ï–ô–°–¢–í–ò–ï

1. –ù–∞–∂–∞—Ç—å **Save** (Ctrl+S)
2. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ workflow —Å–æ—Ö—Ä–∞–Ω—ë–Ω

---

### –®–∞–≥ 4: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è –¢–†–ï–ë–£–ï–¢–°–Ø –î–ï–ô–°–¢–í–ò–ï

**4.1 –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ**

```json
{
  "tenant_id": "a0000000-0000-0000-0000-000000000001",
  "appeal_id": "00000000-0000-0000-0000-000000000001",
  "current_message": "–£ –º–µ–Ω—è –¥–≤–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞: iPhone 14 - –±–∞—Ç–∞—Ä–µ—è –∏ —Ä–∞–∑–±–∏—Ç —ç–∫—Ä–∞–Ω, –∏ Samsung S23 - –Ω–µ –∑–∞—Ä—è–∂–∞–µ—Ç—Å—è",
  "message_history": [
    {
      "timestamp": "2025-11-23T10:00:00Z",
      "is_client": true,
      "text": "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, —Ö–æ—á—É –æ—Ç—Ä–µ–º–æ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–ª–µ—Ñ–æ–Ω—ã"
    }
  ]
}
```

**4.2 –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∞**

1. –í workflow –∫–ª–∏–∫–Ω—É—Ç—å **Test workflow**
2. –í—Å—Ç–∞–≤–∏—Ç—å JSON –≤—ã—à–µ
3. –ù–∞–∂–∞—Ç—å **Execute**

**4.3 –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç**

–í –ø–æ—Å–ª–µ–¥–Ω–µ–º node **Map To DB IDs**:

```json
{
  "tenant_id": "a0000000-0000-0000-0000-000000000001",
  "appeal_id": "00000000-0000-0000-0000-000000000001",
  "is_multi_device": true,
  "device_count": 2,
  "devices": [
    {
      "brand": "Apple",
      "brand_id": "...",
      "model": "iPhone 14",
      "repairs": [
        {
          "category_id": "5295580f-2229-42cf-8460-3418a3dbae9d",
          "category_name": "–ê–∫–∫—É–º—É–ª—è—Ç–æ—Ä",
          "symptoms": "–±–∞—Ç–∞—Ä–µ—è"
        },
        {
          "category_id": "08a21976-68f2-4474-b7f8-7f032d0da88c",
          "category_name": "–î–∏—Å–ø–ª–µ–π",
          "symptoms": "—Ä–∞–∑–±–∏—Ç —ç–∫—Ä–∞–Ω"
        }
      ]
    },
    {
      "brand": "Samsung",
      "brand_id": "...",
      "model": "Galaxy S23",
      "repairs": [
        {
          "category_id": "d4a2546c-1041-4b8f-9deb-e3e9310c5239",
          "category_name": "–ü–æ—Ä—Ç—ã",
          "symptoms": "–Ω–µ –∑–∞—Ä—è–∂–∞–µ—Ç—Å—è"
        }
      ]
    }
  ]
}
```

---

### –®–∞–≥ 5: –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã

**–¢–µ—Å—Ç 1: –û–¥–Ω–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ**
```json
{
  "current_message": "iPhone 13, —Ä–∞–∑–±–∏—Ç —ç–∫—Ä–∞–Ω"
}
```

–û–∂–∏–¥–∞–µ–º–æ:
- `is_multi_device: false`
- `device_count: 1`
- 1 —Ä–µ–º–æ–Ω—Ç (–î–∏—Å–ø–ª–µ–π)

**–¢–µ—Å—Ç 2: –û–¥–Ω–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ, –Ω–µ—Å–∫–æ–ª—å–∫–æ –Ω–µ–∏—Å–ø—Ä–∞–≤–Ω–æ—Å—Ç–µ–π**
```json
{
  "current_message": "–ê–π—Ñ–æ–Ω 14 –ø—Ä–æ - –±–∞—Ç–∞—Ä–µ—è –±—ã—Å—Ç—Ä–æ —Å–∞–¥–∏—Ç—Å—è, —ç–∫—Ä–∞–Ω —Ä–∞–∑–±–∏—Ç –∏ –∫–∞–º–µ—Ä–∞ –Ω–µ —Ñ–æ–∫—É—Å–∏—Ä—É–µ—Ç—Å—è"
}
```

–û–∂–∏–¥–∞–µ–º–æ:
- `is_multi_device: false`
- `device_count: 1`
- 3 —Ä–µ–º–æ–Ω—Ç–∞ (–ê–∫–∫—É–º—É–ª—è—Ç–æ—Ä, –î–∏—Å–ø–ª–µ–π, –ö–∞–º–µ—Ä–∞)

**–¢–µ—Å—Ç 3: –ù–µ–ø–æ–ª–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è**
```json
{
  "current_message": "–¢–µ–ª–µ—Ñ–æ–Ω –Ω–µ –≤–∫–ª—é—á–∞–µ—Ç—Å—è"
}
```

–û–∂–∏–¥–∞–µ–º–æ:
- `brand: null`
- `model: null`
- 1 —Ä–µ–º–æ–Ω—Ç (–ú–∞—Ç–µ—Ä–∏–Ω—Å–∫–∞—è –ø–ª–∞—Ç–∞)

---

### –®–∞–≥ 6: –ü–æ–ª—É—á–∏—Ç—å Workflow ID

**–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è –¢–†–ï–ë–£–ï–¢–°–Ø –î–ï–ô–°–¢–í–ò–ï

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞:

1. –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å Workflow ID –∏–∑ URL
2. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

**–ü—Ä–∏–º–µ—Ä URL:**
```
https://n8n.n8nsrv.ru/workflow/XXXXXXXXXXXXX
```

---

### –®–∞–≥ 7: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ BAT AI Appeal Router

**–û–ø—Ü–∏—è A: –ü—Ä–æ—Å—Ç–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (–¥–ª—è –Ω–∞—á–∞–ª–∞)**

1. –û—Ç–∫—Ä—ã—Ç—å **BAT AI Appeal Router**
2. –ù–∞–π—Ç–∏ –º–µ—Å—Ç–æ –≤—ã–∑–æ–≤–∞ AI Tools
3. –î–æ–±–∞–≤–∏—Ç—å node **Execute Workflow**:
   - Workflow ID: (–∏–∑ –®–∞–≥–∞ 6)
4. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å

**–û–ø—Ü–∏—è B: –ü–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (—Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞)**

–°–º. –æ—Å–Ω–æ–≤–Ω–æ–π [DEPLOYMENT_CHECKLIST.md](DEPLOYMENT_CHECKLIST.md), –®–∞–≥ 8

---

## üêõ Troubleshooting

### –û—à–∏–±–∫–∞: "OpenAI API error: 401"
**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å OpenAI credential –≤ n8n
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –±–∞–ª–∞–Ω—Å OpenAI: https://platform.openai.com/usage
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ API key –∞–∫—Ç–∏–≤–µ–Ω

### –û—à–∏–±–∫–∞: "Model not found"
**–†–µ—à–µ–Ω–∏–µ:**
- –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –≤—ã–±—Ä–∞–Ω–∞ –º–æ–¥–µ–ª—å `gpt-4o-mini`
- –ï—Å–ª–∏ –º–æ–¥–µ–ª—å –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞, –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å `gpt-3.5-turbo`

### –û—à–∏–±–∫–∞: "Failed to parse JSON"
**–†–µ—à–µ–Ω–∏–µ:**
- –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å—ã—Ä–æ–π –æ—Ç–≤–µ—Ç –≤ node **Call OpenAI**
- OpenAI –∏–Ω–æ–≥–¥–∞ –¥–æ–±–∞–≤–ª—è–µ—Ç —Ç–µ–∫—Å—Ç –¥–æ/–ø–æ—Å–ª–µ JSON
- Node **Parse AI Response** –¥–æ–ª–∂–µ–Ω —ç—Ç–æ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å

### –ù–∏–∑–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è
**–†–µ—à–µ–Ω–∏–µ:**
- –£–≤–µ–ª–∏—á–∏—Ç—å temperature —Å 0.3 –¥–æ 0.5
- –£–ª—É—á—à–∏—Ç—å –ø—Ä–æ–º–ø—Ç –≤ node **Build AI Prompt**
- –î–æ–±–∞–≤–∏—Ç—å –±–æ–ª—å—à–µ –ø—Ä–∏–º–µ—Ä–æ–≤ –≤ –ø—Ä–æ–º–ø—Ç

---

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ: OpenAI vs Anthropic

| –ü–∞—Ä–∞–º–µ—Ç—Ä | OpenAI GPT-4o-mini | Anthropic Claude 3.5 |
|:---------|:-------------------|:---------------------|
| **–°—Ç–æ–∏–º–æ—Å—Ç—å** | $0.0005/–∑–∞–ø—Ä–æ—Å | $0.012/–∑–∞–ø—Ä–æ—Å |
| **–°–∫–æ—Ä–æ—Å—Ç—å** | ~1-2 —Å–µ–∫ | ~2-4 —Å–µ–∫ |
| **–¢–æ—á–Ω–æ—Å—Ç—å** | 95%+ | 98%+ |
| **Credentials** | ‚úÖ –£–∂–µ –µ—Å—Ç—å | ‚ö†Ô∏è –ù—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å |
| **–ù–∞—Å—Ç—Ä–æ–π–∫–∞** | ‚úÖ –ü—Ä–æ—Å—Ç–∞—è | ‚ö†Ô∏è –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ headers |
| **–†—É—Å—Å–∫–∏–π —è–∑—ã–∫** | ‚úÖ –•–æ—Ä–æ—à–æ | ‚úÖ –û—Ç–ª–∏—á–Ω–æ |

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
- **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ/Dev:** OpenAI GPT-4o-mini
- **Production (–µ—Å–ª–∏ –Ω—É–∂–Ω–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å):** Anthropic Claude 3.5
- **Production (–µ—Å–ª–∏ –≤–∞–∂–Ω–∞ —Ü–µ–Ω–∞):** OpenAI GPT-4o-mini

---

## ‚úÖ Success Metrics

–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å:

1. **–¢–æ—á–Ω–æ—Å—Ç—å –∏–∑–≤–ª–µ—á–µ–Ω–∏—è**: >95% –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
2. **–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è**: 1-2 —Å–µ–∫—É–Ω–¥—ã
3. **–°—Ç–æ–∏–º–æ—Å—Ç—å**: ~$0.0005 –∑–∞ –∑–∞—è–≤–∫—É
4. **–ü—Ä–æ—Ü–µ–Ω—Ç –æ—à–∏–±–æ–∫**: <1%

---

## üìù –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –¥–µ–ø–ª–æ—è:

1. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** –ø–µ—Ä–≤—ã—Ö 100 –∑–∞—è–≤–æ–∫
2. **–°—Ä–∞–≤–Ω–µ–Ω–∏–µ** —Å OpenAI –∏ Anthropic (A/B test)
3. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è** –ø—Ä–æ–º–ø—Ç–∞ –ø–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º
4. **–ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ** –Ω–∞ production

---

**–ê–≤—Ç–æ—Ä:** Claude Code + User
**–î–∞—Ç–∞:** 2025-11-23
**–í–µ—Ä—Å–∏—è:** 1.0 (OpenAI)
**Model:** GPT-4o-mini

**Endpoints:**
- n8n: https://n8n.n8nsrv.ru
- OpenAI Console: https://platform.openai.com/
