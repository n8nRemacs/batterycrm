{
  "name": "ELO_AI_Chat",
  "active": true,
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "elo-ai-chat",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "f6a7b8c9-d0e1-9f0a-e13c-6d7e8f9a0b1c",
      "name": "Webhook",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [0, 0],
      "webhookId": "elo-ai-chat"
    },
    {
      "parameters": {
        "jsCode": "const input = $input.first().json.body || $input.first().json;\n\n// Required fields\nif (!input.messages || !Array.isArray(input.messages) || input.messages.length === 0) {\n  throw new Error('Missing required field: messages (non-empty array)');\n}\n\n// Validate message format\nfor (const msg of input.messages) {\n  if (!msg.role || !msg.content) {\n    throw new Error('Each message must have role and content');\n  }\n}\n\nreturn {\n  messages: input.messages,\n  tools: input.tools || null,\n  model: input.model || null,\n  max_tokens: input.max_tokens || 4096,\n  temperature: input.temperature || 0.7,\n  trace_id: input.trace_id || `trace_${Date.now()}`\n};"
      },
      "id": "a7b8c9d0-e1f2-0a1b-f24d-7e8f9a0b1c2d",
      "name": "Validate Input",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [220, 0]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "http://45.144.177.128:8774/chat",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ JSON.stringify({ messages: $json.messages, tools: $json.tools, model: $json.model, max_tokens: $json.max_tokens, temperature: $json.temperature }) }}",
        "options": {
          "timeout": 120000
        }
      },
      "id": "b8c9d0e1-f2a3-1b2c-035e-8f9a0b1c2d3e",
      "name": "Call AI Tool MCP",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [440, 0]
    },
    {
      "parameters": {
        "jsCode": "const input = $('Validate Input').first().json;\nconst response = $input.first().json;\n\nreturn {\n  ...response,\n  trace_id: input.trace_id\n};"
      },
      "id": "c9d0e1f2-a3b4-2c3d-146f-9a0b1c2d3e4f",
      "name": "Add trace_id",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [660, 0]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ $json }}"
      },
      "id": "d0e1f2a3-b4c5-3d4e-257a-0b1c2d3e4f5a",
      "name": "Respond to Webhook",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [880, 0]
    }
  ],
  "connections": {
    "Webhook": {
      "main": [
        [
          {
            "node": "Validate Input",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Validate Input": {
      "main": [
        [
          {
            "node": "Call AI Tool MCP",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Call AI Tool MCP": {
      "main": [
        [
          {
            "node": "Add trace_id",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Add trace_id": {
      "main": [
        [
          {
            "node": "Respond to Webhook",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "tags": ["ELO", "AI", "polygon"]
}
