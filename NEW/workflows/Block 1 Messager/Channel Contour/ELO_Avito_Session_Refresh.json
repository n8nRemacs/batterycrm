{"updatedAt":"2025-12-24T07:07:50.818Z","createdAt":"2025-12-23T17:46:43.304Z","id":"SUEamG8HK42dcj2U","name":"ELO_Avito_Session_Refresh","description":null,"active":true,"isArchived":false,"nodes":[{"parameters":{"rule":{"interval":[{"field":"cronExpression","expression":"0 10 * * *"}]}},"id":"96ce9556-0649-4bbd-901a-f293860100f9","name":"Daily 10:00","type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.2,"position":[-2128,0],"notes":"Runs once daily at 10:00. Change time as needed."},{"parameters":{"operation":"executeQuery","query":"SELECT id, tenant_id, account_id, account_name, credentials, session_status\nFROM elo_t_channel_accounts \nWHERE channel_id = 3 \n  AND is_active = true \n  AND credentials->>'sessid' IS NOT NULL\nORDER BY updated_at ASC","options":{}},"id":"11988932-236e-4f2c-810d-2af6ec44c684","name":"Get All Avito Accounts","type":"n8n-nodes-base.postgres","typeVersion":2.5,"position":[-1904,0],"credentials":{"postgres":{"id":"n2SyhP9QhMnp1ryk","name":"Postgres account"}}},{"parameters":{"options":{}},"id":"b8e01b7d-3441-4561-8360-15ea61066111","name":"One by One","type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[-1680,0]},{"parameters":{},"id":"2458516a-091b-4999-af92-7e2c03a3abb2","name":"Wait 30-90s","type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-1392,-272],"webhookId":"7e749cc6-fdb4-4e23-9a3f-8b760df37f1b","notes":"Random delay between accounts for anti-detection"},{"parameters":{"url":"https://m.avito.ru/api/1/profile/short","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Cookie","value":"=sessid={{ $json.credentials.sessid }}; auth=1"},{"name":"User-Agent","value":"={{ ['Mozilla/5.0 (Linux; Android 10; SM-G975F) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.120 Mobile Safari/537.36', 'Mozilla/5.0 (Linux; Android 11; Pixel 5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/92.0.4515.159 Mobile Safari/537.36', 'Mozilla/5.0 (Linux; Android 12; Samsung Galaxy S21) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.104 Mobile Safari/537.36'][Math.floor(Math.random() * 3)] }}"}]},"options":{"timeout":10000}},"id":"b2f6831b-59fd-4096-bdcd-820edf21689f","name":"Check Session","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-1088,-272],"onError":"continueErrorOutput"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict"},"conditions":[{"id":"condition-valid","leftValue":"={{ $json.id }}","rightValue":"","operator":{"type":"string","operation":"exists"}}],"combinator":"and"},"options":{}},"id":"29bb0d97-31d5-4dc5-acfd-be4a5a9f6ad0","name":"Session Valid?","type":"n8n-nodes-base.if","typeVersion":2,"position":[-704,-272]},{"parameters":{"operation":"executeQuery","query":"UPDATE elo_t_channel_accounts \nSET session_status = 'active',\n    updated_at = NOW(),\n    error_count = 0,\n    last_error = NULL\nWHERE id = '{{ $('One by One').item.json.id }}'","options":{}},"id":"eabc2bca-9b5f-403b-b2e2-ffe4f2b1280e","name":"Mark Active","type":"n8n-nodes-base.postgres","typeVersion":2.5,"position":[-352,-272],"credentials":{"postgres":{"id":"n2SyhP9QhMnp1ryk","name":"Postgres account"}}},{"parameters":{"operation":"executeQuery","query":"UPDATE elo_t_channel_accounts \nSET session_status = 'expired',\n    updated_at = NOW(),\n    error_count = error_count + 1,\n    last_error = 'Session expired - 401 Unauthorized'\nWHERE id = '{{ $('One by One').item.json.id }}'","options":{}},"id":"a2801803-4c0e-4901-ab1a-5217edb8f32d","name":"Mark Expired","type":"n8n-nodes-base.postgres","typeVersion":2.5,"position":[-128,112],"credentials":{"postgres":{"id":"n2SyhP9QhMnp1ryk","name":"Postgres account"}}},{"parameters":{},"id":"2bf53d36-bc1c-41f5-a88d-f8b116f5b097","name":"Next Account","type":"n8n-nodes-base.noOp","typeVersion":1,"position":[-1376,0]}],"connections":{"Daily 10:00":{"main":[[{"node":"Get All Avito Accounts","type":"main","index":0}]]},"Get All Avito Accounts":{"main":[[{"node":"One by One","type":"main","index":0}]]},"One by One":{"main":[[{"node":"Wait 30-90s","type":"main","index":0}],[{"node":"Next Account","type":"main","index":0}]]},"Wait 30-90s":{"main":[[{"node":"Check Session","type":"main","index":0}]]},"Check Session":{"main":[[{"node":"Session Valid?","type":"main","index":0}],[{"node":"Mark Expired","type":"main","index":0}]]},"Session Valid?":{"main":[[{"node":"Mark Active","type":"main","index":0}],[{"node":"Mark Expired","type":"main","index":0}]]},"Mark Active":{"main":[[{"node":"One by One","type":"main","index":0}]]},"Mark Expired":{"main":[[{"node":"One by One","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":{"node:Daily 10:00":{"recurrenceRules":[]}},"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"e463b320-7638-478e-bd65-affbec035c5e","activeVersionId":"e463b320-7638-478e-bd65-affbec035c5e","versionCounter":10,"triggerCount":1,"shared":[{"updatedAt":"2025-12-23T17:46:43.321Z","createdAt":"2025-12-23T17:46:43.321Z","role":"workflow:owner","workflowId":"SUEamG8HK42dcj2U","projectId":"x7frUSUEowDAk8Dt","project":{"updatedAt":"2025-08-25T18:57:22.218Z","createdAt":"2025-08-25T08:16:18.805Z","id":"x7frUSUEowDAk8Dt","name":"Dmitriy Remacs <dk@n8nsrv.ru>","type":"personal","icon":null,"description":null,"projectRelations":[{"updatedAt":"2025-08-25T08:16:18.805Z","createdAt":"2025-08-25T08:16:18.805Z","userId":"1d5222a1-8f53-4940-b7de-93daeae04393","projectId":"x7frUSUEowDAk8Dt","user":{"updatedAt":"2025-12-27T08:39:03.000Z","createdAt":"2025-08-25T08:16:17.784Z","id":"1d5222a1-8f53-4940-b7de-93daeae04393","email":"dk@n8nsrv.ru","firstName":"Dmitriy","lastName":"Remacs","personalizationAnswers":null,"settings":{"userActivated":true,"easyAIWorkflowOnboarded":true,"firstSuccessfulWorkflowId":"RbSUhceYc7q41M5j","userActivatedAt":1756286438389},"disabled":false,"mfaEnabled":false,"lastActiveAt":"2025-12-26","isPending":false}}]}}],"tags":[],"activeVersion":{"updatedAt":"2025-12-23T18:17:28.507Z","createdAt":"2025-12-23T18:17:28.507Z","versionId":"e463b320-7638-478e-bd65-affbec035c5e","workflowId":"SUEamG8HK42dcj2U","nodes":[{"parameters":{"rule":{"interval":[{"field":"cronExpression","expression":"0 10 * * *"}]}},"id":"96ce9556-0649-4bbd-901a-f293860100f9","name":"Daily 10:00","type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.2,"position":[-2128,0],"notes":"Runs once daily at 10:00. Change time as needed."},{"parameters":{"operation":"executeQuery","query":"SELECT id, tenant_id, account_id, account_name, credentials, session_status\nFROM elo_t_channel_accounts \nWHERE channel_id = 3 \n  AND is_active = true \n  AND credentials->>'sessid' IS NOT NULL\nORDER BY updated_at ASC","options":{}},"id":"11988932-236e-4f2c-810d-2af6ec44c684","name":"Get All Avito Accounts","type":"n8n-nodes-base.postgres","typeVersion":2.5,"position":[-1904,0],"credentials":{"postgres":{"id":"n2SyhP9QhMnp1ryk","name":"Postgres account"}}},{"parameters":{"options":{}},"id":"b8e01b7d-3441-4561-8360-15ea61066111","name":"One by One","type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[-1680,0]},{"parameters":{},"id":"2458516a-091b-4999-af92-7e2c03a3abb2","name":"Wait 30-90s","type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-1392,-272],"webhookId":"7e749cc6-fdb4-4e23-9a3f-8b760df37f1b","notes":"Random delay between accounts for anti-detection"},{"parameters":{"url":"https://m.avito.ru/api/1/profile/short","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Cookie","value":"=sessid={{ $json.credentials.sessid }}; auth=1"},{"name":"User-Agent","value":"={{ ['Mozilla/5.0 (Linux; Android 10; SM-G975F) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.120 Mobile Safari/537.36', 'Mozilla/5.0 (Linux; Android 11; Pixel 5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/92.0.4515.159 Mobile Safari/537.36', 'Mozilla/5.0 (Linux; Android 12; Samsung Galaxy S21) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.104 Mobile Safari/537.36'][Math.floor(Math.random() * 3)] }}"}]},"options":{"timeout":10000}},"id":"b2f6831b-59fd-4096-bdcd-820edf21689f","name":"Check Session","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-1088,-272],"onError":"continueErrorOutput"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict"},"conditions":[{"id":"condition-valid","leftValue":"={{ $json.id }}","rightValue":"","operator":{"type":"string","operation":"exists"}}],"combinator":"and"},"options":{}},"id":"29bb0d97-31d5-4dc5-acfd-be4a5a9f6ad0","name":"Session Valid?","type":"n8n-nodes-base.if","typeVersion":2,"position":[-704,-272]},{"parameters":{"operation":"executeQuery","query":"UPDATE elo_t_channel_accounts \nSET session_status = 'active',\n    updated_at = NOW(),\n    error_count = 0,\n    last_error = NULL\nWHERE id = '{{ $('One by One').item.json.id }}'","options":{}},"id":"eabc2bca-9b5f-403b-b2e2-ffe4f2b1280e","name":"Mark Active","type":"n8n-nodes-base.postgres","typeVersion":2.5,"position":[-352,-272],"credentials":{"postgres":{"id":"n2SyhP9QhMnp1ryk","name":"Postgres account"}}},{"parameters":{"operation":"executeQuery","query":"UPDATE elo_t_channel_accounts \nSET session_status = 'expired',\n    updated_at = NOW(),\n    error_count = error_count + 1,\n    last_error = 'Session expired - 401 Unauthorized'\nWHERE id = '{{ $('One by One').item.json.id }}'","options":{}},"id":"a2801803-4c0e-4901-ab1a-5217edb8f32d","name":"Mark Expired","type":"n8n-nodes-base.postgres","typeVersion":2.5,"position":[-128,112],"credentials":{"postgres":{"id":"n2SyhP9QhMnp1ryk","name":"Postgres account"}}},{"parameters":{},"id":"2bf53d36-bc1c-41f5-a88d-f8b116f5b097","name":"Next Account","type":"n8n-nodes-base.noOp","typeVersion":1,"position":[-1376,0]}],"connections":{"Daily 10:00":{"main":[[{"node":"Get All Avito Accounts","type":"main","index":0}]]},"Get All Avito Accounts":{"main":[[{"node":"One by One","type":"main","index":0}]]},"One by One":{"main":[[{"node":"Wait 30-90s","type":"main","index":0}],[{"node":"Next Account","type":"main","index":0}]]},"Wait 30-90s":{"main":[[{"node":"Check Session","type":"main","index":0}]]},"Check Session":{"main":[[{"node":"Session Valid?","type":"main","index":0}],[{"node":"Mark Expired","type":"main","index":0}]]},"Session Valid?":{"main":[[{"node":"Mark Active","type":"main","index":0}],[{"node":"Mark Expired","type":"main","index":0}]]},"Mark Active":{"main":[[{"node":"One by One","type":"main","index":0}]]},"Mark Expired":{"main":[[{"node":"One by One","type":"main","index":0}]]}},"authors":"Dmitriy Remacs","name":null,"description":null}}