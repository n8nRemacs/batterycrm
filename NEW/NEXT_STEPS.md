# –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è ELO

> **–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 10 –¥–µ–∫–∞–±—Ä—è 2025, 01:45 (UTC+4)
> **–°—Ç–∞—Ç—É—Å:** –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ OLD –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

---

## –°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –∫ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ

```
1. –ü—Ä–æ—Ä–∞–±–æ—Ç–∞—Ç—å –≤—Å–µ –±–ª–æ–∫–∏ (–ø–æ–Ω—è—Ç—å —á—Ç–æ –ï–°–¢–¨ –≤ OLD –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ)
   ‚îú‚îÄ‚îÄ Channel Layer ‚úÖ DONE (12/12)
   ‚îú‚îÄ‚îÄ Input Contour ‚úÖ DONE (5/5)
   ‚îú‚îÄ‚îÄ Core üîÑ –†–ê–ó–û–ë–†–ê–ù (–Ω–µ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω)
   ‚îú‚îÄ‚îÄ Graph üîÑ –ù–ê–ß–ê–¢ (4 –æ—Ç–∫—Ä—ã—Ç—ã—Ö –≤–æ–ø—Ä–æ—Å–∞)
   ‚îî‚îÄ‚îÄ API ‚è≥ TODO (25+ endpoints)

2. –°–æ–∑–¥–∞—Ç—å –ø–æ–¥—Ä–æ–±–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É NEW –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã (–∫–∞–∫ –î–û–õ–ñ–ù–û –±—ã—Ç—å)

3. –°–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ë–î (elo_* —Ç–∞–±–ª–∏—Ü—ã)

4. –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–µ –≤–æ—Ä–∫–µ—Ä—ã

5. –î–µ–±–∞–≥ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
```

**–í–∞–∂–Ω–æ:** –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ OLD –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã (BAT_*) ‚Äî —ç—Ç–æ –ù–ï –ø–ª–∞–Ω –¥–ª—è NEW –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã (ELO_*). –≠—Ç–æ —ç—Ç–∞–ø –ø–æ–Ω–∏–º–∞–Ω–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –ª–æ–≥–∏–∫–∏ –ø–µ—Ä–µ–¥ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º –Ω–æ–≤–æ–π.

---

## –°–µ—Å—Å–∏—è 10.12.2025 (–Ω–æ—á—å) ‚Äî –ü–æ–¥—Ä–æ–±–Ω—ã–π –æ—Ç—á—ë—Ç

### –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

#### 1. –°–æ–∑–¥–∞–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

**–ü–∞–ø–∫–∞:** `NEW/Core_info/`

```
NEW/Core_info/
‚îú‚îÄ‚îÄ INDEX.md                          # –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –≤—Å–µ–º –±–ª–æ–∫–∞–º
‚îú‚îÄ‚îÄ HOW_TO_DOCUMENT.md                # –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
‚îú‚îÄ‚îÄ 01_Channel_Layer/
‚îÇ   ‚îî‚îÄ‚îÄ workflows_info/
‚îÇ       ‚îú‚îÄ‚îÄ ELO_In_Telegram.md        ‚úÖ
‚îÇ       ‚îú‚îÄ‚îÄ ELO_In_WhatsApp.md        ‚úÖ
‚îÇ       ‚îú‚îÄ‚îÄ ELO_In_Avito.md           ‚úÖ
‚îÇ       ‚îú‚îÄ‚îÄ ELO_In_VK.md              ‚úÖ
‚îÇ       ‚îú‚îÄ‚îÄ ELO_In_MAX.md             ‚úÖ
‚îÇ       ‚îú‚îÄ‚îÄ ELO_In_Form.md            ‚úÖ
‚îÇ       ‚îú‚îÄ‚îÄ ELO_In_Phone.md           ‚úÖ
‚îÇ       ‚îú‚îÄ‚îÄ ELO_Out_Telegram.md       ‚úÖ
‚îÇ       ‚îú‚îÄ‚îÄ ELO_Out_WhatsApp.md       ‚úÖ
‚îÇ       ‚îú‚îÄ‚îÄ ELO_Out_Avito.md          ‚úÖ
‚îÇ       ‚îú‚îÄ‚îÄ ELO_Out_VK.md             ‚úÖ
‚îÇ       ‚îî‚îÄ‚îÄ ELO_Out_MAX.md            ‚úÖ
‚îú‚îÄ‚îÄ 02_Input_Contour/
‚îÇ   ‚îî‚îÄ‚îÄ workflows_info/
‚îÇ       ‚îú‚îÄ‚îÄ INPUT_CONTOUR_OVERVIEW.md ‚úÖ
‚îÇ       ‚îú‚îÄ‚îÄ ELO_Core_Tenant_Resolver.md   ‚úÖ
‚îÇ       ‚îú‚îÄ‚îÄ ELO_Core_Queue_Processor.md   ‚úÖ
‚îÇ       ‚îú‚îÄ‚îÄ ELO_Core_Batch_Debouncer.md   ‚úÖ
‚îÇ       ‚îî‚îÄ‚îÄ ELO_Core_Client_Resolver.md   ‚úÖ
‚îú‚îÄ‚îÄ 03_Core/
‚îÇ   ‚îî‚îÄ‚îÄ workflows_info/               # TODO
‚îú‚îÄ‚îÄ 04_Graph/
‚îÇ   ‚îî‚îÄ‚îÄ workflows_info/
‚îÇ       ‚îî‚îÄ‚îÄ GRAPH_OVERVIEW.md         ‚úÖ
‚îú‚îÄ‚îÄ 05_Diagnostic_Engine/
‚îÇ   ‚îî‚îÄ‚îÄ workflows_info/               # –ù–µ—Ç workflows
‚îî‚îÄ‚îÄ 06_API/
    ‚îî‚îÄ‚îÄ workflows_info/
        ‚îú‚îÄ‚îÄ API_Android_Auth.md       ‚úÖ
        ‚îî‚îÄ‚îÄ API_Android_Appeals_List.md ‚úÖ
```

#### 2. Channel Layer ‚Äî –ø–æ–ª–Ω–æ—Å—Ç—å—é –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω (12/12)

**ELO_In workflows (7 —à—Ç):**

| Workflow | Nodes | –ü–∞—Ç—Ç–µ—Ä–Ω | –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ |
|----------|-------|---------|-------------|
| ELO_In_Telegram | 12 | Standard | MCP payload, tg_ prefix, Redis queue |
| ELO_In_WhatsApp | 10 | Standard | Wappi.pro, phone from chatId (79991234567@c.us) |
| ELO_In_Avito | 13 | Standard | System filter (author_id===user_id), item_id |
| ELO_In_VK | 15 | Standard | Confirmation flow, response="ok" text |
| ELO_In_MAX | 10 | Standard | Phone normalization (8‚Üí7) |
| ELO_In_Form | 5 | **Direct** | NO Redis, prefilled_data.model |
| ELO_In_Phone | 7 | **Direct** | NO Redis, ALWAYS voice |

**–ü–∞—Ç—Ç–µ—Ä–Ω—ã ELO_In:**
- **Standard (5):** Telegram, WhatsApp, VK, MAX, Avito ‚Üí Redis queue (async)
- **Direct (2):** Form, Phone ‚Üí NO Redis (—Ä–µ–¥–∫–∏–µ, —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ)

**ELO_Out workflows (5 —à—Ç):**

| Workflow | Nodes | Credentials | –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ |
|----------|-------|-------------|-------------|
| ELO_Out_Telegram | 8 | SQL tenant_configs | MCP API tg.eldoleado.ru |
| ELO_Out_WhatsApp | 5 | Direct | wappi.pro/api/sync |
| ELO_Out_Avito | 11 | Redis cache (TTL 86400) | OAuth refresh, text escape |
| ELO_Out_VK | 5 | N/A | random_id required |
| ELO_Out_MAX | 5 | N/A | MAX_API_URL env |

**–û–±—â–∏–π –ø–∞—Ç—Ç–µ—Ä–Ω ELO_Out:**
```
Execute Trigger ‚Üí [Get Credentials?] ‚Üí Send ‚Üí Process ‚Üí Save History ‚Üí Register Touchpoint
```

#### 3. Input Contour ‚Äî –ø–æ–ª–Ω–æ—Å—Ç—å—é –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω (5/5)

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø–æ—Ç–æ–∫–∞:**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  IN Workflows (–±—ã—Å—Ç—Ä—ã–µ, ~100ms)                                             ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê               ‚îÇ
‚îÇ  ‚îÇTelegram ‚îÇ ‚îÇWhatsApp ‚îÇ ‚îÇ  Avito  ‚îÇ ‚îÇ   VK    ‚îÇ ‚îÇ   MAX   ‚îÇ               ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îò               ‚îÇ
‚îÇ       ‚îÇ           ‚îÇ           ‚îÇ           ‚îÇ           ‚îÇ                    ‚îÇ
‚îÇ       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                    ‚îÇ
‚îÇ                         ‚Üì                                                   ‚îÇ
‚îÇ         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                                  ‚îÇ
‚îÇ         ‚îÇ  1. ELO_Core_Tenant_Resolver  ‚îÇ  ‚Üê –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç tenant             ‚îÇ
‚îÇ         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                                  ‚îÇ
‚îÇ                         ‚Üì                                                   ‚îÇ
‚îÇ         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                                  ‚îÇ
‚îÇ         ‚îÇ  Redis RPUSH queue:incoming   ‚îÇ  ‚Üê –±—ã—Å—Ç—Ä–æ –∏ —É—Ö–æ–¥—è—Ç               ‚îÇ
‚îÇ         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                                  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                          ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Batcher (–º–µ–¥–ª–µ–Ω–Ω—ã–π, 10s debounce)                                          ‚îÇ
‚îÇ         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                                   ‚îÇ
‚îÇ         ‚îÇ  2. ELO_Core_Queue_Processor  ‚îÇ  ‚Üê –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫                   ‚îÇ
‚îÇ         ‚îÇ     POP –∏–∑ queue:incoming     ‚îÇ                                   ‚îÇ
‚îÇ         ‚îÇ     –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ chat_id    ‚îÇ                                   ‚îÇ
‚îÇ         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                                   ‚îÇ
‚îÇ                         ‚Üì                                                    ‚îÇ
‚îÇ         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                                   ‚îÇ
‚îÇ         ‚îÇ  3. ELO_Core_Batch_Debouncer  ‚îÇ  ‚Üê –∂–¥—ë—Ç 10s —Ç–∏—à–∏–Ω—ã                ‚îÇ
‚îÇ         ‚îÇ     √ó10 –∫–æ–ø–∏–π (–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ)   ‚îÇ                                   ‚îÇ
‚îÇ         ‚îÇ     –°–∫–ª–µ–∏–≤–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è       ‚îÇ                                   ‚îÇ
‚îÇ         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                                   ‚îÇ
‚îÇ                         ‚Üì                                                    ‚îÇ
‚îÇ         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                                   ‚îÇ
‚îÇ         ‚îÇ  4. ELO_Core_Client_Resolver  ‚îÇ  ‚Üê –Ω–∞—Ö–æ–¥–∏—Ç/—Å–æ–∑–¥–∞—ë—Ç –∫–ª–∏–µ–Ω—Ç–∞       ‚îÇ
‚îÇ         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                                   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                          ‚Üì
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ   CORE    ‚îÇ
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**Redis –∫–ª—é—á–∏ Input Contour:**

| –ö–ª—é—á | –¢–∏–ø | TTL | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|------|-----|-----|------------|
| `queue:incoming` | List | ‚Äî | –ì–ª–æ–±–∞–ª—å–Ω–∞—è –≤—Ö–æ–¥—è—â–∞—è –æ—á–µ—Ä–µ–¥—å |
| `queue:processor:lock` | String | short | Mutex –¥–ª—è Queue Processor |
| `queue:batch:{channel}:{chat_id}` | List | ‚Äî | Per-chat –æ—á–µ—Ä–µ–¥—å —Å–æ–æ–±—â–µ–Ω–∏–π |
| `lock:batch:{channel}:{chat_id}` | String | 300s | Per-chat lock –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É |
| `last_seen:{channel}:{chat_id}` | String | ‚Äî | Timestamp –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è |

**Debounce –ª–æ–≥–∏–∫–∞:**
- –ñ–¥—ë–º **10 —Å–µ–∫—É–Ω–¥ —Ç–∏—à–∏–Ω—ã** (user confirmed: 20s —Å–ª–∏—à–∫–æ–º –¥–æ–ª–≥–æ)
- –ú–∞–∫—Å–∏–º—É–º **300 —Å–µ–∫—É–Ω–¥** –æ–∂–∏–¥–∞–Ω–∏—è (–∑–∞—â–∏—Ç–∞ –æ—Ç chatty users)
- –ü–æ—Å–ª–µ debounce ‚Äî —Å–∫–ª–µ–∏–≤–∞–µ–º –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –æ–¥–∏–Ω —Ç–µ–∫—Å—Ç
- –ì–æ–ª–æ—Å–æ–≤—ã–µ –ø–æ–º–µ—á–∞—é—Ç—Å—è `[–ì–æ–ª–æ—Å–æ–≤–æ–µ]: {transcription}`

**–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ workflows:**

1. **ELO_Core_Tenant_Resolver** (rRO6sxLqiCdgvLZz)
   - 7 nodes
   - –ú–∞–ø–ø–∏–Ω–≥ channel ‚Üí lookup_key (telegram‚Üítelegram_bot_token, vk‚Üívk_app_id, etc.)
   - Default tenant UUID: `a0000000-0000-0000-0000-000000000001`

2. **ELO_Core_Queue_Processor** (–±–µ–∑ ID, Schedule Trigger)
   - Schedule: every 5 seconds
   - 10√ó –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π POP (workaround –¥–ª—è n8n)
   - –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ batch_key = `{channel}:{external_chat_id}`
   - –î–≤—É—Ö—É—Ä–æ–≤–Ω–µ–≤–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ (processor + per-chat)

3. **ELO_Core_Batch_Debouncer** (hwYfaLAKCwaWpoQk) √ó10 –∫–æ–ø–∏–π
   - Debounce loop: Wait ‚Üí Check Silence ‚Üí Ready?
   - Combine Messages: sort by timestamp, join with `\n\n`
   - TODO: per-tenant debounce setting –≤ elo_tenants

4. **ELO_Core_Client_Resolver** (–±–µ–∑ ID)
   - Find Client SQL —Å JOIN client_merges
   - –ü–æ–∏—Å–∫ –ø–æ phone/telegram_id/vk_id/whatsapp_id/avito_id
   - Client Exists? ‚Üí Merge / Execute Client Creator
   - ‚Üí Execute Appeal Manager (–≥—Ä–∞–Ω–∏—Ü–∞ —Å Core)

#### 4. Core ‚Äî —Ä–∞–∑–æ–±—Ä–∞–Ω, –ù–ï –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω

**–ü—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ workflows:**

| Workflow | ID | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|----------|-----|------------|
| BAT_Appeal_Manager | L2pYPcv7r8j5XFU3 | –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –≤ Core |
| BAT_AI_Appeal_Router | Flhmu33l0ZhZhr90 | AI –º–æ–∑–≥, –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è |
| BAT_AI_Task_Dispatcher | aEzuOXgpLBTNZ4ie | –î–∏—Å–ø–µ—Ç—á–µ—Ä AI –∑–∞–¥–∞—á |
| BAT_AI_Universal_Worker | CDHwzDiXqh3t0Iam | AI –≤–æ—Ä–∫–µ—Ä (√ó7 –∫–æ–ø–∏–π) |
| BAT_Client_Creator | vkQwat1iZhJJj7C9 | –°–æ–∑–¥–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞ |

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ Core (–ø–æ–Ω—è—Ç–∞, –Ω–µ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∞):**

```
Client Resolver
      ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  ELO_Core_Appeal_Manager (L2pYPcv7r8j5XFU3)                     ‚îÇ
‚îÇ    ‚Ä¢ Find Active Appeal (7 –¥–Ω–µ–π, –Ω–µ –∑–∞–≤–µ—Ä—à—ë–Ω)                   ‚îÇ
‚îÇ    ‚Ä¢ Create New Appeal (–µ—Å–ª–∏ –Ω–µ—Ç)                               ‚îÇ
‚îÇ    ‚Ä¢ Save Message History                                       ‚îÇ
‚îÇ    ‚Ä¢ Register Touchpoint (Neo4j webhook)                        ‚îÇ
‚îÇ    ‚Üí Execute AI Router                                          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  ELO_Core_AI_Router (Flhmu33l0ZhZhr90)                          ‚îÇ
‚îÇ    ‚Ä¢ Load Appeal & Devices (SQL + history + devices)            ‚îÇ
‚îÇ    ‚Ä¢ Load Fields Config (context_fields_config)                 ‚îÇ
‚îÇ    ‚Ä¢ Prepare Context (focus, disambiguation, completeness %)    ‚îÇ
‚îÇ    ‚Ä¢ Needs Extraction? ‚Üí Task Dispatcher                        ‚îÇ
‚îÇ    ‚Ä¢ Call Graph Matcher (Neo4j webhook)                         ‚îÇ
‚îÇ    ‚Ä¢ AI Response Generator (OpenAI)                             ‚îÇ
‚îÇ    ‚Ä¢ Route by Completeness (full/partial/minimal)               ‚îÇ
‚îÇ    ‚Ä¢ Update Appeal Data (SQL)                                   ‚îÇ
‚îÇ    ‚Ä¢ Route By Mode:                                             ‚îÇ
‚îÇ        - auto ‚Üí Call Client Response Sender                     ‚îÇ
‚îÇ        - assist ‚Üí Call Operator Notifier                        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**operation_mode:**
- **auto** ‚Äî AI –æ—Ç–≤–µ—á–∞–µ—Ç –∫–ª–∏–µ–Ω—Ç—É –Ω–∞–ø—Ä—è–º—É—é
- **assist** ‚Äî AI –≥–æ—Ç–æ–≤–∏—Ç –æ—Ç–≤–µ—Ç, –æ–ø–µ—Ä–∞—Ç–æ—Ä –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç

**–†–µ—à–µ–Ω–æ:** Core –æ—Ç–ª–æ–∂–µ–Ω –¥–æ –ø—Ä–æ—Ä–∞–±–æ—Ç–∫–∏ –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –±–ª–æ–∫–æ–≤. –≠—Ç–æ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –±–ª–æ–∫, –µ–≥–æ –Ω—É–∂–Ω–æ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥ –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ.

#### 5. Graph ‚Äî –Ω–∞—á–∞—Ç, –µ—Å—Ç—å –æ—Ç–∫—Ä—ã—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã

**–ü—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ workflows (5 —à—Ç):**

| Workflow | ID | Webhook |
|----------|-----|---------|
| BAT_Neo4j_Context_Builder | gF8hYMVuCRqCkw83 | /neo4j/context |
| BAT_Neo4j_CRUD | gtm1CfLF557Ta40P | /neo4j/crud |
| BAT_Neo4j_Sync | Jqu7d7yWOjyxm80x | /neo4j/sync |
| BAT_Neo4j_Touchpoint_Register | TrCjdgREvPAB2yyL | /neo4j/touchpoint/register |
| BAT_Neo4j_Touchpoint_Tracker | tKHYEwn1AR18UrDS | /neo4j/touchpoint |

**Neo4j Schema (–∏–∑ –∞–Ω–∞–ª–∏–∑–∞):**

```
Node Types:
- Client (id, phone, name)
- Device (id, brand, model, owner_label)
- Problem (id, type, status)
- ProblemType (code)
- Channel (type, identifier, verified)
- Vertical (type)
- Touchpoint (id, timestamp, type, channel, direction)

Edge Types:
- Client -[:OWNS]-> Device
- Device -[:HAS_PROBLEM]-> Problem
- Problem -[:OF_TYPE]-> ProblemType
- Client -[:HAS_CHANNEL]-> Channel
- Client -[:CUSTOMER_OF]-> Vertical
- Touchpoint -[:FROM]-> Client (inbound)
- Touchpoint -[:TO]-> Client (outbound)
- Touchpoint -[:ABOUT_DEVICE]-> Device
- Touchpoint -[:ABOUT_PROBLEM]-> Problem
- Touchpoint -[:IN_VERTICAL]-> Vertical
```

**–°–æ–∑–¥–∞–Ω:** `04_Graph/workflows_info/GRAPH_OVERVIEW.md`

---

## –û–¢–ö–†–´–¢–´–ï –í–û–ü–†–û–°–´ –ü–û GRAPH (–Ω–∞ —É—Ç—Ä–æ!)

### 1. Register vs Tracker ‚Äî –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–ª–∏ —Ä–∞–∑–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏?

**Touchpoint Register** (`/webhook/neo4j/touchpoint/register`):
```
–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:
- client_id (required)
- appeal_id
- channel
- direction: inbound | outbound | mutual
- type: message | call | visit | promo | form
- is_new_client
- vertical_id
- tenant_id

–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:
1. –°–æ–∑–¥–∞—ë—Ç Touchpoint node –≤ Neo4j
2. –°–≤—è–∑—å —Å Client: FROM (inbound), TO (outbound), –∏–ª–∏ –û–ë–ï (mutual)
3. –°–≤—è–∑—å —Å Vertical –µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω
4. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ PostgreSQL —Ç–∞–±–ª–∏—Ü—É touchpoints
```

**Touchpoint Tracker** (`/webhook/neo4j/touchpoint`):
```
–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:
- client_id (required)
- message_id
- channel
- direction: inbound | outbound (–ë–ï–ó mutual!)
- type
- mentioned_device_id    ‚Üê –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ
- mentioned_problem_id   ‚Üê –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ
- confidence (0-1)       ‚Üê –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ
- explicit (bool)        ‚Üê –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ

–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:
1. –°–æ–∑–¥–∞—ë—Ç Touchpoint node –≤ Neo4j
2. –°–≤—è–∑—å —Å Client: FROM –∏–ª–∏ TO
3. –°–≤—è–∑—å ABOUT_DEVICE (–µ—Å–ª–∏ —É–ø–æ–º—è–Ω—É—Ç–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ)
4. –°–≤—è–∑—å ABOUT_PROBLEM (–µ—Å–ª–∏ —É–ø–æ–º—è–Ω—É—Ç–∞ –ø—Ä–æ–±–ª–µ–º–∞)
5. –ù–ï —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ PostgreSQL!
```

**–°—Ä–∞–≤–Ω–µ–Ω–∏–µ:**

| –ê—Å–ø–µ–∫—Ç | Register | Tracker |
|--------|----------|---------|
| PostgreSQL | ‚úÖ –î–∞ | ‚ùå –ù–µ—Ç |
| mutual direction | ‚úÖ –î–∞ | ‚ùå –ù–µ—Ç |
| ABOUT_DEVICE | ‚ùå –ù–µ—Ç | ‚úÖ –î–∞ |
| ABOUT_PROBLEM | ‚ùå –ù–µ—Ç | ‚úÖ –î–∞ |
| confidence | ‚ùå –ù–µ—Ç | ‚úÖ –î–∞ |

**–ì–∏–ø–æ—Ç–µ–∑–∞:**
- Register = —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ñ–∞–∫—Ç–∞ –∫–æ–Ω—Ç–∞–∫—Ç–∞ (–¥–ª—è –≤–æ—Ä–æ–Ω–∫–∏, –∞–Ω–∞–ª–∏—Ç–∏–∫–∏)
- Tracker = —Ç—Ä–µ–∫–∏–Ω–≥ —á—Ç–æ –æ–±—Å—É–∂–¥–∞–ª–∏ (–¥–ª—è AI –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞)

**–í–æ–ø—Ä–æ—Å:** –≠—Ç–æ –≤–µ—Ä–Ω–æ? –ò–ª–∏ –æ–Ω–∏ –¥–æ–ª–∂–Ω—ã —Ä–∞–±–æ—Ç–∞—Ç—å –≤–º–µ—Å—Ç–µ? –ò–ª–∏ —ç—Ç–æ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ—Ç–æ—Ä–æ–µ –Ω—É–∂–Ω–æ –æ–±—ä–µ–¥–∏–Ω–∏—Ç—å?

### 2. Direction ‚Äî –∫—Ç–æ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç inbound/outbound/mutual?

–í –∫–æ–¥–µ Touchpoint Register –µ—Å—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:
```javascript
// –õ–æ–≥–∏–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è direction:
// - is_new_client && –Ω–µ—Ç —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –≤ –±–∞–∑–µ ‚Üí inbound
// - is_new_client && –µ—Å—Ç—å —Ç–µ–ª–µ—Ñ–æ–Ω –≤ –±–∞–∑–µ ‚Üí mutual
// - –ø—Ä–æ–º–æ/—Ä–∞—Å—Å—ã–ª–∫–∞ ‚Üí outbound
// - –¥–∏–∞–ª–æ–≥ (–µ—Å—Ç—å inbound + –±—ã–ª –æ—Ç–≤–µ—Ç + –∫–ª–∏–µ–Ω—Ç –Ω–∞–ø–∏—Å–∞–ª) ‚Üí mutual
```

–ù–æ —ç—Ç–æ —Ç–æ–ª—å–∫–æ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π, –Ω–µ –∫–æ–¥!

**–í–æ–ø—Ä–æ—Å:** –ö—Ç–æ —Ä–µ–∞–ª—å–Ω–æ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç direction?
- –í—ã–∑—ã–≤–∞—é—â–∏–π workflow –ø–µ—Ä–µ–¥–∞—ë—Ç –≥–æ—Ç–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ?
- –ò–ª–∏ Graph –¥–æ–ª–∂–µ–Ω —Å–∞–º –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å –ø–æ –ª–æ–≥–∏–∫–µ?

### 3. enrichment_paths ‚Äî —á—Ç–æ —ç—Ç–æ –∑–∞ —Ç–∞–±–ª–∏—Ü–∞?

–í Context Builder –µ—Å—Ç—å action `enrichment_suggestion`:
```javascript
// –ó–∞–ø—Ä–æ—Å –∫ PostgreSQL
SELECT * FROM enrichment_paths WHERE enabled = true ORDER BY priority DESC, conversion_rate DESC

// –õ–æ–≥–∏–∫–∞
const suggestions = enrichmentPaths
  .filter(path => {
    const hasFrom = existingTypes.has(path.from_channel_type);
    const needsTo = !existingTypes.has(path.to_channel_type);
    return hasFrom && needsTo;
  })
  .slice(0, 3);
```

**–í–æ–ø—Ä–æ—Å:** –ß—Ç–æ —ç—Ç–æ –∑–∞ —Ç–∞–±–ª–∏—Ü–∞? –°—Ç—Ä—É–∫—Ç—É—Ä–∞? –ü—É—Ç–∏ –∫–æ–Ω–≤–µ—Ä—Å–∏–∏ —Ç–∏–ø–∞ "telegram ‚Üí —Å–æ–±—Ä–∞—Ç—å phone"?

### 4. –ö–æ–≥–¥–∞ –∫–∞–∫–æ–π touchpoint –≤—ã–∑—ã–≤–∞—Ç—å?

**–í–æ–ø—Ä–æ—Å:**
- Register ‚Üí –¥–ª—è –≤—Å–µ—Ö –≤—Ö–æ–¥—è—â–∏—Ö/–∏—Å—Ö–æ–¥—è—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π?
- Tracker ‚Üí —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ AI –æ–ø—Ä–µ–¥–µ–ª–∏–ª —É–ø–æ–º–∏–Ω–∞–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –≤ —Ç–µ–∫—Å—Ç–µ?

---

## –ü—Ä–µ–¥—ã–¥—É—â–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç (–∏–∑ –ø—Ä–æ—à–ª—ã—Ö —Å–µ—Å—Å–∏–π)

### –ì–ª–æ–±–∞–ª—å–Ω–∞—è —Å—Ö–µ–º–∞ (`GLOBAL_SCHEMA.md`)

- **–ü—Ä–∏–Ω—Ü–∏–ø—ã:**
  - –í—Å–µ —Ç–∞–±–ª–∏—Ü—ã —Ä–µ–ª—è—Ü–∏–æ–Ω–Ω—ã–µ (–Ω–∏–∫–∞–∫–æ–≥–æ —Ö–∞—Ä–¥–∫–æ–¥–∞, —Ç–æ–ª—å–∫–æ FK)
  - –ì–∏–±—Ä–∏–¥–Ω—ã–µ ID: INT –¥–ª—è —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–æ–≤, UUID –¥–ª—è —Å—É—â–Ω–æ—Å—Ç–µ–π
  - –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –ø–∞–∫–µ—Ç –º–µ–∂–¥—É –±–ª–æ–∫–∞–º–∏: `{tenant_id, dialog_id}`

- **–ò–µ—Ä–∞—Ä—Ö–∏—è:** –î–æ–º–µ–Ω ‚Üí –í–µ—Ä—Ç–∏–∫–∞–ª—å (–æ–¥–∏–Ω –¥–æ–º–µ–Ω –Ω–∞ —Ç–µ–Ω–∞–Ω—Ç–∞ –¥–ª—è MVP)

- **–°–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏ (7):**
  - elo_domains, elo_verticals, elo_channels
  - elo_dialog_statuses, elo_message_types, elo_directions
  - elo_operator_types

- **–û—Å–Ω–æ–≤–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏ (5):**
  - elo_tenants, elo_operators, elo_clients
  - elo_dialogs, elo_messages

- **–°–≤—è–∑—É—é—â–∏–µ:**
  - elo_tenant_verticals, elo_dialog_verticals
  - elo_channel_accounts, elo_client_channels

- **–ö–æ–Ω—Ç—Ä–∞–∫—Ç—ã –¥–∞–Ω–Ω—ã—Ö:**
  - Internal: `{tenant_id, dialog_id}`
  - External (API ‚Üí App): —Ä–∞–∑–≤—ë—Ä–Ω—É—Ç—ã–π –æ–±—ä–µ–∫—Ç

### 6 –±–ª–æ–∫–æ–≤ —Å–∏—Å—Ç–µ–º—ã

| # | –ë–ª–æ–∫ | –°—Ç–∞—Ç—É—Å | –î–æ–∫—É–º–µ–Ω—Ç–æ–≤ |
|---|------|--------|------------|
| 1 | Channel Layer (IN/OUT) | ‚úÖ DONE | 12/12 |
| 2 | Billing | ‚è≥ TODO | ‚Äî |
| 3 | Input Contour | ‚úÖ DONE | 5/5 |
| 4 | Core | üîÑ –†–∞–∑–æ–±—Ä–∞–Ω | 0 |
| 5 | Graph (Neo4j) | üîÑ –ù–∞—á–∞—Ç | 1 + –≤–æ–ø—Ä–æ—Å—ã |
| 6 | Diagnostic Engine | ‚ùì –ù–µ—Ç workflows | 0 |
| ‚Äî | API | üîÑ –ù–∞—á–∞—Ç | 2/27 |

---

## Naming convention

- **BAT** prefix = BattCRM (—Å—Ç–∞—Ä–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞)
- **ELO** prefix = Eldoleado (–Ω–æ–≤–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ)
- Channel Layer (ELO_In_*, ELO_Out_*) —É–∂–µ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω
- Input Contour –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç ELO_Core_* (—Ö–æ—Ç—è JSON –µ—â—ë BAT_*)
- Core workflows (BAT_Appeal_Manager, etc.) –µ—â—ë –Ω–µ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω—ã
- `n8n_old/` ‚Äî –ø–∞–ø–∫–∞ —Å–æ –≤—Å–µ–º–∏ OLD BAT_* workflows
- `ELO_Core/` ‚Äî –ø–∞–ø–∫–∞ –¥–ª—è NEW ELO_Core_* workflows (–ø–æ–∫–∞ –ø—É—Å—Ç–∞—è)

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞–ø–æ–∫ (–∞–∫—Ç—É–∞–ª—å–Ω–∞—è)

```
NEW/
‚îú‚îÄ‚îÄ GLOBAL_SCHEMA.md              # –û–±—â–∞—è —Å—Ö–µ–º–∞ (—Ç–∞–±–ª–∏—Ü—ã, –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã)
‚îú‚îÄ‚îÄ NEXT_STEPS.md                 # –≠—Ç–æ—Ç —Ñ–∞–π–ª
‚îú‚îÄ‚îÄ Core_info/                    # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –±–ª–æ–∫–∞–º
‚îÇ   ‚îú‚îÄ‚îÄ INDEX.md                  # –ù–∞–≤–∏–≥–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ HOW_TO_DOCUMENT.md        # –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ 01_Channel_Layer/         # ‚úÖ 12/12
‚îÇ   ‚îú‚îÄ‚îÄ 02_Input_Contour/         # ‚úÖ 5/5
‚îÇ   ‚îú‚îÄ‚îÄ 03_Core/                  # TODO
‚îÇ   ‚îú‚îÄ‚îÄ 04_Graph/                 # üîÑ 1 + –≤–æ–ø—Ä–æ—Å—ã
‚îÇ   ‚îú‚îÄ‚îÄ 05_Diagnostic_Engine/     # –ù–µ—Ç workflows
‚îÇ   ‚îî‚îÄ‚îÄ 06_API/                   # üîÑ 2/27
‚îî‚îÄ‚îÄ workflows/
    ‚îú‚îÄ‚îÄ ELO_InOut/                # –ù–æ–≤—ã–µ ELO_In/Out
    ‚îÇ   ‚îú‚îÄ‚îÄ ELO_In/               # 7 workflows
    ‚îÇ   ‚îî‚îÄ‚îÄ ELO_Out/              # 5 workflows
    ‚îî‚îÄ‚îÄ n8n_old/                  # –°—Ç–∞—Ä—ã–µ BAT_* workflows
        ‚îú‚îÄ‚îÄ API/                  # 27 workflows
        ‚îú‚îÄ‚îÄ Core/                 # ~20 workflows
        ‚îú‚îÄ‚îÄ In/                   # 7 workflows
        ‚îú‚îÄ‚îÄ Out/                  # 5 workflows
        ‚îú‚îÄ‚îÄ TaskWork/             # Debouncer√ó10, Worker√ó7, OutProcessor√ó6
        ‚îî‚îÄ‚îÄ Tool/                 # AI tools
```

---

## –ü–ª–∞–Ω —Å–ª–µ–¥—É—é—â–µ–π —Å–µ—Å—Å–∏–∏ (—É—Ç—Ä–æ 10.12.2025)

### 1. –†–∞–∑–æ–±—Ä–∞—Ç—å –≤–æ–ø—Ä–æ—Å—ã –ø–æ Graph

–ü–æ –ø–æ—Ä—è–¥–∫—É:
1. Register vs Tracker
2. Direction –ª–æ–≥–∏–∫–∞
3. enrichment_paths —Ç–∞–±–ª–∏—Ü–∞
4. –ö–æ–≥–¥–∞ –∫–∞–∫–æ–π touchpoint

### 2. –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å Graph (5 workflows)

–ü–æ—Å–ª–µ –æ—Ç–≤–µ—Ç–æ–≤ –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã:
- ELO_Graph_Context_Builder.md
- ELO_Graph_CRUD.md
- ELO_Graph_Sync.md
- ELO_Graph_Touchpoint_Register.md
- ELO_Graph_Touchpoint_Tracker.md

### 3. –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å API (25+ workflows)

–ü–æ—Å–ª–µ Graph ‚Äî –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å Android API –∏ Operator API.

### 4. –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ Core

–ü–æ—Å–ª–µ –ø–æ–Ω–∏–º–∞–Ω–∏—è –≤—Å–µ—Ö –±–ª–æ–∫–æ–≤ ‚Äî –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å Core –∫–∞–∫ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç.

---

## Quick Reference

### Redis –∫–ª—é—á–∏ (–≤—Å–µ –±–ª–æ–∫–∏)

**Input Contour:**
- `queue:incoming` ‚Äî –≥–ª–æ–±–∞–ª—å–Ω–∞—è –≤—Ö–æ–¥—è—â–∞—è –æ—á–µ—Ä–µ–¥—å
- `queue:processor:lock` ‚Äî mutex –¥–ª—è Queue Processor
- `queue:batch:{key}` ‚Äî per-chat –æ—á–µ—Ä–µ–¥—å
- `lock:batch:{key}` ‚Äî per-chat lock (TTL 300s)
- `last_seen:{key}` ‚Äî timestamp

**Core:**
- `ai_extraction_queue` ‚Äî –æ—á–µ—Ä–µ–¥—å –∑–∞–¥–∞—á –¥–ª—è AI Workers
- `batch:{id}:status` ‚Äî —Å—Ç–∞—Ç—É—Å –±–∞—Ç—á–∞ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è (TTL 300s)

**Channel Layer (Avito):**
- `avito_access_token` ‚Äî OAuth token (TTL 86400s)

### Webhooks (Neo4j)

| Webhook | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|---------|------------|
| POST /webhook/neo4j/context | AI –∫–æ–Ω—Ç–µ–∫—Å—Ç (get_context, disambiguation, match_entities, enrichment) |
| POST /webhook/neo4j/crud | CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏ |
| POST /webhook/neo4j/sync | PostgreSQL ‚Üí Neo4j —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è |
| POST /webhook/neo4j/touchpoint/register | –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∫–∞—Å–∞–Ω–∏—è |
| POST /webhook/neo4j/touchpoint | –¢—Ä–µ–∫–∏–Ω–≥ —É–ø–æ–º–∏–Ω–∞–Ω–∏–π |

### –ö–ª—é—á–µ–≤—ã–µ ID workflows

| Workflow | ID |
|----------|-----|
| Tenant Resolver | rRO6sxLqiCdgvLZz |
| Batch Debouncer | hwYfaLAKCwaWpoQk |
| Client Creator | vkQwat1iZhJJj7C9 |
| Appeal Manager | L2pYPcv7r8j5XFU3 |
| AI Router | Flhmu33l0ZhZhr90 |
| Task Dispatcher | aEzuOXgpLBTNZ4ie |
| AI Worker | CDHwzDiXqh3t0Iam |
| Client Response Sender | Gxd1gIKgk8HxuOya |
| Operator Notifier | GUeLgLcNnawYfpf9 |
| Context Builder | gF8hYMVuCRqCkw83 |
| Neo4j CRUD | gtm1CfLF557Ta40P |
| Neo4j Sync | Jqu7d7yWOjyxm80x |
| Touchpoint Register | TrCjdgREvPAB2yyL |
| Touchpoint Tracker | tKHYEwn1AR18UrDS |
