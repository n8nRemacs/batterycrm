{
  "id": "gtm1CfLF557Ta40P",
  "name": "BAT Neo4j CRUD",
  "active": true,
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "neo4j/crud",
        "responseMode": "responseNode",
        "options": {}
      },
      "name": "Webhook",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -736,
        -464
      ],
      "webhookId": "neo4j-crud",
      "id": "89468832-c9b2-4248-be9b-9b0016ea4de8"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 1
          },
          "conditions": [
            {
              "leftValue": "={{ $json.body.operation }}",
              "rightValue": "create",
              "operator": {
                "type": "string",
                "operation": "equals"
              },
              "id": "83c5c318-8dc4-45fe-b3d1-d8ebf87dd3c7"
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "name": "Is Create?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        -512,
        -464
      ],
      "id": "96326909-d847-44ea-a09b-b63e2ee46861"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 1
          },
          "conditions": [
            {
              "leftValue": "={{ $json.body.operation }}",
              "rightValue": "read",
              "operator": {
                "type": "string",
                "operation": "equals"
              },
              "id": "870af248-5fbc-4a82-aaad-dab64a36ae4c"
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "name": "Is Read?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        -512,
        -256
      ],
      "id": "ef4a216a-7159-449c-b930-bd60bca6dfce"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 1
          },
          "conditions": [
            {
              "leftValue": "={{ $json.body.operation }}",
              "rightValue": "update",
              "operator": {
                "type": "string",
                "operation": "equals"
              },
              "id": "962f9f57-9309-4347-a180-74e27d2f5207"
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "name": "Is Update?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        -512,
        -64
      ],
      "id": "bf9653eb-64db-4ed0-932a-e5b1956bf306"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 1
          },
          "conditions": [
            {
              "leftValue": "={{ $json.body.operation }}",
              "rightValue": "delete",
              "operator": {
                "type": "string",
                "operation": "equals"
              },
              "id": "bdd6f39e-08b2-4dd2-855a-a8abb66902d1"
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "name": "Is Delete?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        -512,
        144
      ],
      "id": "1e1b4b5b-ef70-468c-bd5b-7bf737b90565"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "http://45.144.177.128:7474/db/neo4j/tx/commit",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpBasicAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ JSON.stringify({ statements: [{ statement: \"MERGE (n:\" + $('Webhook').item.json.body.nodeType + \" {id: $id}) SET n += $props RETURN n\", parameters: { id: $('Webhook').item.json.body.nodeId, props: $('Webhook').item.json.body.properties || {} } }] }) }}",
        "options": {}
      },
      "name": "Neo4j Create",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -240,
        -560
      ],
      "id": "b48790a6-4ba2-49d1-b992-c9a08156f5e2",
      "credentials": {
        "httpBasicAuth": {
          "id": "bkJBnz7p38fXY4AN",
          "name": "Neo4j"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "http://45.144.177.128:7474/db/neo4j/tx/commit",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpBasicAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ (function() { var nodeId = $('Webhook').item.json.body.nodeId; var nodeType = $('Webhook').item.json.body.nodeType; if (nodeId) { return JSON.stringify({ statements: [{ statement: 'MATCH (n:' + nodeType + ' {id: $id}) RETURN n', parameters: { id: nodeId } }] }); } else { return JSON.stringify({ statements: [{ statement: 'MATCH (n:' + nodeType + ') RETURN n LIMIT 100', parameters: {} }] }); } })() }}",
        "options": {}
      },
      "name": "Neo4j Read",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -240,
        -368
      ],
      "id": "e23d472b-4ce0-4a35-bb4c-191912735de0",
      "credentials": {
        "httpBasicAuth": {
          "id": "bkJBnz7p38fXY4AN",
          "name": "Neo4j"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "http://45.144.177.128:7474/db/neo4j/tx/commit",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpBasicAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ JSON.stringify({ statements: [{ statement: \"MATCH (n:\" + $('Webhook').item.json.body.nodeType + \" {id: $id}) SET n += $props RETURN n\", parameters: { id: $('Webhook').item.json.body.nodeId, props: $('Webhook').item.json.body.properties || {} } }] }) }}",
        "options": {}
      },
      "name": "Neo4j Update",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -240,
        -160
      ],
      "id": "a3f59877-5e59-424b-9761-999a57aaad06",
      "credentials": {
        "httpBasicAuth": {
          "id": "bkJBnz7p38fXY4AN",
          "name": "Neo4j"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "http://45.144.177.128:7474/db/neo4j/tx/commit",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpBasicAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ JSON.stringify({ statements: [{ statement: \"MATCH (n:\" + $('Webhook').item.json.body.nodeType + \" {id: $id}) DETACH DELETE n RETURN count(*) as deleted\", parameters: { id: $('Webhook').item.json.body.nodeId } }] }) }}",
        "options": {}
      },
      "name": "Neo4j Delete",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -240,
        48
      ],
      "id": "4cb8d906-777b-454a-8143-39e316691b07",
      "credentials": {
        "httpBasicAuth": {
          "id": "bkJBnz7p38fXY4AN",
          "name": "Neo4j"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const result = $input.first().json;\n\nif (result.errors && result.errors.length > 0) {\n  return {\n    success: false,\n    error: result.errors.map(e => e.message).join('; '),\n    data: []\n  };\n}\n\nconst data = result.results && result.results[0] && result.results[0].data ? result.results[0].data : [];\nconst nodes = data.map(d => d.row ? d.row[0] : d);\n\nreturn {\n  success: true,\n  count: nodes.length,\n  data: nodes\n};"
      },
      "name": "Format Response",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        48,
        -256
      ],
      "id": "b9681ab1-098e-4049-b6c7-25dbe04db713"
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ $json }}",
        "options": {}
      },
      "name": "Respond",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [
        272,
        -256
      ],
      "id": "d01f535d-a977-4e29-ad46-d347b3e2b5ec"
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ { success: false, error: \"Unknown operation. Use: create, read, update, delete\" } }}",
        "options": {
          "responseCode": 400
        }
      },
      "name": "Respond Error",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [
        -240,
        352
      ],
      "id": "52a446ec-2252-4843-a522-052d4e4cb05f"
    }
  ],
  "connections": {
    "Webhook": {
      "main": [
        [
          {
            "node": "Is Create?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Is Create?": {
      "main": [
        [
          {
            "node": "Neo4j Create",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Is Read?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Is Read?": {
      "main": [
        [
          {
            "node": "Neo4j Read",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Is Update?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Is Update?": {
      "main": [
        [
          {
            "node": "Neo4j Update",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Is Delete?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Is Delete?": {
      "main": [
        [
          {
            "node": "Neo4j Delete",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Respond Error",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Neo4j Create": {
      "main": [
        [
          {
            "node": "Format Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Neo4j Read": {
      "main": [
        [
          {
            "node": "Format Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Neo4j Update": {
      "main": [
        [
          {
            "node": "Format Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Neo4j Delete": {
      "main": [
        [
          {
            "node": "Format Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format Response": {
      "main": [
        [
          {
            "node": "Respond",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "tags": [
    {
      "updatedAt": "2025-11-23T03:59:12.594Z",
      "createdAt": "2025-11-23T03:59:12.594Z",
      "id": "8zD9sDD78ytgu5T2",
      "name": "BattCRM"
    },
    {
      "updatedAt": "2025-11-23T04:04:01.292Z",
      "createdAt": "2025-11-23T04:04:01.292Z",
      "id": "eiI07cPEeFxzR69p",
      "name": "Core"
    }
  ],
  "updatedAt": "2025-12-03T12:57:37.000Z",
  "createdAt": "2025-12-02T11:26:35.948Z"
}